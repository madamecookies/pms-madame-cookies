<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>PMS MADAME COOKIES v2.0</title>
    <link rel="stylesheet" href="styles.css">
  <script src="https://unpkg.com/tesseract.js@5.1.0/dist/tesseract.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.1/dist/jspdf.plugin.autotable.min.js"></script>
<script>
(function setDefaultHashForTabs(){
  try{ if(!location.hash){ location.replace(location.pathname + location.search + '#dashboard'); } }catch(e){}
})();
</script>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <div class="header">
            <div class="logo">
                <div class="logo-icon">🍪</div>
                <div>
                    <h1>MADAME COOKIES PMS</h1>
                    <div class="user-info">
                        <span id="current-user">Wendy JEAN MARIE</span> • 
                        <span id="current-date"></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="nav-tabs">
            <button class="nav-tab active" data-tab="dashboard">
                <span class="nav-icon">📊</span>
                <span>Tableau</span>
            </button>
            <a class="nav-tab" href="#temperatures">
                <span class="nav-icon">🌡️</span>
                <span>Températures</span>
            </a>
            <a class="nav-tab" href="#production">
                <span class="nav-icon">🏭</span>
                <span>Production</span>
            </a>
            <a class="nav-tab" href="#nettoyage">
                <span class="nav-icon">🧽</span>
                <span>Nettoyage</span>
            </a>
            <a class="nav-tab" href="#reception">
                <span class="nav-icon">📦</span>
                <span>Réception</span>
            </a>
            <a class="nav-tab" href="#historique">
                <span class="nav-icon">📋</span>
                <span>Historique</span>
            </a>
            <a class="nav-tab" href="#exports">
                <span class="nav-icon">📄</span>
                <span>Exports</span>
            </a>
        </div>

        <!-- Tableau de Bord -->
        <div class="tab-content active" id="dashboard">
            <div class="stats-grid">
                <div class="stat-card" style="border-left-color: #28a745;">
                    <div class="stat-number" style="color: #28a745;" id="stat-conformes">0</div>
                    <div class="stat-label">Contrôles OK</div>
                </div>
                <div class="stat-card" style="border-left-color: #dc3545;">
                    <div class="stat-number" style="color: #dc3545;" id="stat-non-conformes">0</div>
                    <div class="stat-label">Non-Conformités</div>
                </div>
                <div class="stat-card" style="border-left-color: #ffc107;">
                    <div class="stat-number" style="color: #ffc107;" id="stat-productions">0</div>
                    <div class="stat-label">Lots Produits</div>
                </div>
                <div class="stat-card" style="border-left-color: #17a2b8;">
                    <div class="stat-number" style="color: #17a2b8;" id="stat-photos">0</div>
                    <div class="stat-label">Photos Prises</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">🚨 Statut du Jour</h2>
                </div>
                <div id="alertes-jour">
                    <div class="alert alert-success">
                        <span>✅</span> Système opérationnel - Prêt pour les contrôles
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">📅 Actions Recommandées</h2>
                </div>
                <div class="checkbox-group" id="actions-jour">
                    <label class="checkbox-item">
                        <input type="checkbox" id="action-temp-matin" onchange="sauvegarderAction(this)">
                        <span><strong>08:00</strong> - Contrôle températures équipements</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" id="action-production" onchange="sauvegarderAction(this)">
                        <span><strong>09:00</strong> - Saisie production du jour</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" id="action-temp-midi" onchange="sauvegarderAction(this)">
                        <span><strong>12:00</strong> - Second contrôle températures</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" id="action-nettoyage" onchange="sauvegarderAction(this)">
                        <span><strong>13:00</strong> - Plan de nettoyage quotidien</span>
                    </label>
                </div>
            </div>
        </div>

        <!-- Contrôle Températures -->
        <div class="tab-content" id="temperatures">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">🌡️ Contrôle Températures</h2>
                    <button class="btn btn-success" onclick="sauvegarderTemperatures()">
                        💾 Sauvegarder
                    </button>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Date et Heure</label>
                        <input type="datetime-local" class="form-input" id="temp-datetime">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Responsable</label>
                        <select class="form-input" id="temp-responsable">
                            <option>Wendy JEAN MARIE</option>
                            <option>Équipe Production</option>
                            <option>Nylaime MAMODALY BANDJEE</option>
                        </select>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">🧊 Unité froide +2 portes<br><small>(Cible: 4,2°C ± 1°C)</small></label>
                        <input type="number" step="0.1" class="form-input temp-input" id="temp-froide" 
                               placeholder="Ex: 4.2" onchange="verifierTemperature(this, 4.2, 1)">
                    </div>
                    <div class="form-group">
                        <label class="form-label">❄️ Unité négative<br><small>(Cible: -13°C ± 2°C)</small></label>
                        <input type="number" step="0.1" class="form-input temp-input" id="temp-negative" 
                               placeholder="Ex: -13.0" onchange="verifierTemperature(this, -13, 2)">
                    </div>
                    <div class="form-group">
                        <label class="form-label">🧊 Surgélateur 1<br><small>(Cible: -18°C ± 2°C)</small></label>
                        <input type="number" step="0.1" class="form-input temp-input" id="temp-surgel1" 
                               placeholder="Ex: -18.0" onchange="verifierTemperature(this, -18, 2)">
                    </div>
                    <div class="form-group">
                        <label class="form-label">🧊 Surgélateur 2<br><small>(Cible: -18°C ± 2°C)</small></label>
                        <input type="number" step="0.1" class="form-input temp-input" id="temp-surgel2" 
                               placeholder="Ex: -18.0" onchange="verifierTemperature(this, -18, 2)">
                    </div>
                    <div class="form-group">
                        <label class="form-label">🧊 Surgélateur 3<br><small>(Cible: -18°C ± 2°C)</small></label>
                        <input type="number" step="0.1" class="form-input temp-input" id="temp-surgel3" 
                               placeholder="Ex: -18.0" onchange="verifierTemperature(this, -18, 2)">
                    </div>
                    <div class="form-group">
                        <label class="form-label">🌡️ Ambiance atelier<br><small>(Max: 25°C)</small></label>
                        <input type="number" step="0.1" class="form-input temp-input" id="temp-ambiance" 
                               placeholder="Ex: 22.0" onchange="verifierTemperature(this, 25, 0, 'max')">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Actions correctives (si nécessaire)</label>
                    <textarea class="form-input" id="temp-actions" rows="3" 
                              placeholder="Décrire les actions prises en cas de température non conforme..."></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">📷 Photos équipements</label>
                    <div class="photo-upload" onclick="ouvrirCamera('temperatures')">
                        <span class="photo-icon">📷</span>
                        <div><strong>Prendre une photo</strong></div>
                        <div>Équipements de froid</div>
                    </div>
                    <div class="photo-preview" id="temp-photos"></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">📊 Derniers Contrôles</h2>
                    <button class="btn btn-primary" onclick="exporterTemperaturesPDF()">
                        📄 Export PDF
                    </button>
                </div>
                <div style="overflow-x: auto;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Date/Heure</th>
                                <th>Froide</th>
                                <th>Négative</th>
                                <th>Surgél.1</th>
                                <th>Surgél.2</th>
                                <th>Surgél.3</th>
                                <th>Ambiance</th>
                                <th>Statut</th>
                            </tr>
                        </thead>
                        <tbody id="table-temperatures">
                            <!-- Les données seront ajoutées ici -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Production -->
        <div class="tab-content" id="production">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">🏭 Nouvelle Production</h2>
                    <button class="btn btn-success" onclick="sauvegarderProduction()">
                        💾 Enregistrer
                    </button>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">N° Lot (auto-généré)</label>
                        <input type="text" class="form-input" id="prod-lot" readonly>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Variété Cookie</label>
                        <select class="form-input" id="prod-variete">
                            <option value="">-- Choisir une variété --</option>
                            <option>LAIT</option>
                            <option>NOIR</option>
                            <option>3 CHOCOLAT</option>
                            <option>FULL</option>
                            <option>NATURE</option>
                            <option>KINDER</option>
                            <option>SNICKERS</option>
                            <option>MATCHA</option>
                            <option>M&MS</option>
                            <option>NOISETTES</option>
                            <option>PÉCAN</option>
                            <option>PISTACHE</option>
                            <option>SPÉCULOOS</option>
                            <option>CRANBERRIES</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Quantité (pièces)</label>
                        <input type="number" class="form-input" id="prod-quantite" placeholder="Ex: 250">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Heure Début</label>
                        <input type="time" class="form-input" id="prod-debut">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Heure Fin</label>
                        <input type="time" class="form-input" id="prod-fin">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Température Cuisson (°C)</label>
                        <input type="number" class="form-input" id="prod-temperature" placeholder="160-180°C">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Observations qualité</label>
                    <textarea class="form-input" id="prod-observations" rows="3" 
                              placeholder="Notes sur l'aspect, texture, cuisson..."></textarea>
                </div>

                
                    <div class="form-group">
                        <label class="form-label">🏷️ Étiquettes Matières Premières</label>
                        <div class="hint">Ajoute chaque MP, photographie l’étiquette : l’OCR propose le <strong>N° de lot</strong>.</div>
                        <div id="mp-list" class="mp-list"></div>
                        <div class="mp-actions">
                            <button class="btn btn-secondary" type="button" id="btn-add-mp">➕ Ajouter une MP</button>
                        </div>
                    </div>
    <div class="form-group">
                    <label class="form-label">📷 Photos production</label>
                    <div class="photo-upload" onclick="ouvrirCamera('production')">
                        <span class="photo-icon">📷</span>
                        <div><strong>Photographier le lot</strong></div>
                        <div>Avant/pendant/après cuisson</div>
                    </div>
                    <div class="photo-preview" id="prod-photos"></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">📊 Productions du Jour</h2>
                </div>
                <div style="overflow-x: auto;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>N° Lot</th>
                                <th>Variété</th>
                                <th>Quantité</th>
                                <th>Heure</th>
                                <th>Température</th>
                                <th>Statut</th>
                            </tr>
                        </thead>
                        <tbody id="table-productions">
                            <!-- Les données seront ajoutées ici -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Autres sections... -->
        <div class="tab-content" id="nettoyage">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">🧽 Plan de Nettoyage</h2>
                    <button class="btn btn-success" onclick="sauvegarderNettoyage()">
                        💾 Valider Plan
                    </button>
                </div>
                <p>Section Nettoyage - En développement</p>
            </div>
        </div>

        <div class="tab-content" id="reception">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">📦 Réception Marchandises</h2>
                    <button class="btn btn-success" onclick="sauvegarderReception()">
                        💾 Enregistrer
                    </button>
                </div>
                <p>Section Réception - En développement</p>
            </div>
        </div>

        <div class="tab-content" id="historique">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">📋 Historique Complet</h2>
                </div>
                <div style="overflow-x: auto;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Date/Heure</th>
                                <th>Type</th>
                                <th>Responsable</th>
                                <th>Détails</th>
                                <th>Statut</th>
                            </tr>
                        </thead>
                        <tbody id="table-historique">
                            <!-- Les données seront ajoutées ici -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="tab-content" id="exports">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">📄 Exports et Rapports</h2>
                </div>
                <div class="form-grid">
  <button class="btn btn-success" onclick="genererRapportPDF()">📄 Générer PDF</button>
  <button class="btn btn-primary" onclick="exporterExcel()">📊 Export CSV</button>
  <button class="btn btn-secondary" onclick="syncToGoogleSheets()">🔗 Envoyer vers Google Sheets</button>
  <button class="btn btn-warning" onclick="syncToGitHub()">🐙 Sauvegarder sur GitHub</button>
</div>
<div id="sync-settings" class="card" style="margin-top:16px;">
  <div class="card-header"><h3 class="card-title">⚙️ Paramètres de synchronisation</h3></div>
  <div class="form-grid">
    <div>
      <label class="form-label">Google Apps Script Web App URL</label>
      <input type="url" id="cfg-sheets-url" class="form-input" placeholder="https://script.google.com/macros/s/XXXX/exec">
    </div>
    <div>
      <label class="form-label">GitHub Owner / Repo</label>
      <div style="display:flex; gap:8px;">
        <input type="text" id="cfg-gh-owner" class="form-input" placeholder="madamecookies" style="flex:1;">
        <input type="text" id="cfg-gh-repo" class="form-input" placeholder="pms-data" style="flex:1;">
      </div>
    </div>
    <div>
      <label class="form-label">Branche / Dossier</label>
      <div style="display:flex; gap:8px;">
        <input type="text" id="cfg-gh-branch" class="form-input" placeholder="main" style="flex:1;">
        <input type="text" id="cfg-gh-folder" class="form-input" placeholder="exports" style="flex:1;">
      </div>
    </div>
    <div>
      <label class="form-label">GitHub Token (fine-grained)</label>
      <input type="password" id="cfg-gh-token" class="form-input" placeholder="ghp_...">
      <div class="hint">⚠️ Le token sera stocké <strong>localement</strong> dans ce navigateur. Préfère un token finement limité (repo ciblé en lecture/écriture de contenu uniquement).</div>
    </div>
  </div>
  <div class="form-grid" style="margin-top:8px;">
    <div>
      <label class="form-label">Export auto → Google Sheets</label>
      <div style="display:flex;align-items:center;gap:8px;">
        <input type="checkbox" id="cfg-auto-sync"> <span>Activer</span>
        <input type="number" id="cfg-auto-every" class="form-input" value="5" min="1" style="width:80px"> <span>min</span>
      </div>
      <div class="hint">Simple et efficace : exporte régulièrement vers l’URL Apps Script tant que la page est ouverte.</div>
    </div>
  </div>
  <div style="display:flex; gap:8px; justify-content:flex-end; padding:12px;">
    <button class="btn" onclick="chargerConfigSync()">Charger</button>
    <button class="btn btn-primary" onclick="sauverConfigSync()">Enregistrer</button>
  </div>
</div>
            </div>
        </div>
    </div>

    <!-- Modal Caméra -->
    <div id="modalCamera" class="modal">
        <div class="modal-content">
            <span class="close" onclick="fermerCamera()">&times;</span>
            <h2 style="margin-bottom: 20px;">📷 Prendre une photo</h2>
            <video id="video" autoplay playsinline autoplay playsinline muted></video>
            <canvas id="canvas"></canvas>
            <div class="camera-controls">
                <button class="btn btn-success" onclick="prendrePhoto()">
                    📸 Capturer
                </button>
                <button class="btn btn-danger" onclick="fermerCamera()">
                    ❌ Annuler
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="app.js"></script>
</body>
</html>