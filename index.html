    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/5.1.0/tesseract.min.js"></script>
    <script>
        // Variables globales
        let currentTab = 'dashboard';
        let stream = null;
        let photoContext = '';
        let ocrContext = '';
        let donnees = {
            temperatures: [],
            productions: [],
            nettoyages: [],
            receptions: [],
            actions: {}
        };

        // Initialisation au chargement
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üç™ Initialisation PMS Madame Cookies...');
            
            // Date actuelle
            const maintenant = new Date();
            document.getElementById('current-date').textContent = 
                maintenant.toLocaleDateString('fr-FR', {
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric'
                });

            // Initialiser les champs date/heure
            const tempDatetime = document.getElementById('temp-datetime');
            if (tempDatetime) {
                tempDatetime.value = maintenant.toISOString().slice(0, 16);
            }

            const recepDatetime = document.getElementById('recep-datetime');
            if (recepDatetime) {
                recepDatetime.value = maintenant.toISOString().slice(0, 16);
            }

            const nettoyageDate = document.getElementById('nettoyage-date');
            if (nettoyageDate) {
                nettoyageDate.value = maintenant.toISOString().slice(0, 10);
            }

            // G√©n√©rer num√©ro de lot
            genererNumeroLot();

            // Initialiser navigation
            initNavigation();

            // Charger donn√©es
            chargerDonnees();
            mettreAJourStatistiques();
            verifierBOMCompletude();

            console.log('‚úÖ Application initialis√©e');
        });

        // Navigation
        function initNavigation() {
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.id.replace('tab-', '');
                    changerTab(tabId);
                });
            });
        }

        function changerTab(tabId) {
            console.log('üîÑ Changement onglet vers:', tabId);
            
            // Masquer tous les contenus
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // D√©sactiver tous les boutons
            document.querySelectorAll('.nav-tab').forEach(btn => {
                btn.classList.remove('active');
            });

            // Activer le nouveau contenu et bouton
            const targetContent = document.getElementById('content-' + tabId);
            const targetButton = document.getElementById('tab-' + tabId);

            if (targetContent && targetButton) {
                targetContent.classList.add('active');
                targetButton.classList.add('active');
                currentTab = tabId;
                
                // Charger donn√©es sp√©cifiques si n√©cessaire
                switch(tabId) {
                    case 'temperatures':
                        chargerTableauTemperatures();
                        break;
                    case 'production':
                        chargerTableauProductions();
                        verifierBOMCompletude();
                        break;
                    case 'nettoyage':
                        chargerTableauNettoyage();
                        break;
                    case 'reception':
                        chargerTableauReceptions();
                        break;
                    case 'historique':
                        chargerHistorique();
                        break;
                }

                afficherNotification(`‚úÖ Module ${getTabName(tabId)} activ√©`, 'success');
            } else {
                console.error('‚ùå Onglet introuvable:', tabId);
            }
        }

        function getTabName(tabId) {
            const names = {
                'dashboard': 'Tableau de Bord',
                'temperatures': 'Temp√©ratures',
                'production': 'Production',
                'nettoyage': 'Nettoyage',
                'reception': 'R√©ception',
                'historique': 'Historique',
                'exports': 'Exports'
            };
            return names[tabId] || tabId;
        }

        // Gestion cam√©ra OCR
        function ouvrirCameraOCR(matierePremiere) {
            console.log('üì∑ Ouverture cam√©ra OCR pour:', matierePremiere);
            photoContext = 'ocr';
            ocrContext = matierePremiere;
            
            const modal = document.getElementById('modalCamera');
            const video = document.getElementById('video');

            modal.style.display = 'block';

            // Marquer comme en traitement
            const mpPhoto = document.getElementById(`photo-${matierePremiere}`);
            mpPhoto.classList.add('ocr-processing');
            mpPhoto.innerHTML = '<span style="font-size: 16px;">üì∑<br>üîÑ</span>';

            navigator.mediaDevices.getUserMedia({ 
                video: { 
                    facingMode: 'environment',
                    width: { ideal: 1280 },
                    height: { ideal: 720 }
                } 
            })
            .then(function(mediaStream) {
                stream = mediaStream;
                video.srcObject = stream;
                console.log('‚úÖ Cam√©ra OCR activ√©e');
            })
            .catch(function(err) {
                console.error('‚ùå Erreur cam√©ra OCR:', err);
                afficherNotification('‚ùå Impossible d\'acc√©der √† la cam√©ra', 'danger');
                fermerCamera();
                
                // Restaurer √©tat
                mpPhoto.classList.remove('ocr-processing');
                mpPhoto.innerHTML = '<span style="font-size: 24px;">üì∑</span>';
            });
        }

        // V√©rification temp√©rature
        function verifierTemperature(input, cible, tolerance, type = 'range') {
            const valeur = parseFloat(input.value);
            if (isNaN(valeur)) return;

            input.classList.remove('alert');
            
            let conforme = false;
            if (type === 'max') {
                conforme = valeur <= cible;
            } else {
                conforme = Math.abs(valeur - cible) <= tolerance;
            }

            if (!conforme) {
                input.classList.add('alert');
                afficherNotification(`‚ö†Ô∏è Temp√©rature non conforme: ${valeur}¬∞C`, 'warning');
            } else {
                afficherNotification(`‚úÖ Temp√©rature conforme: ${valeur}¬∞C`, 'success');
            }
        }

        // Gestion cam√©ra standard
        function ouvrirCamera(contexte) {
            console.log('üì∑ Ouverture cam√©ra pour:', contexte);
            photoContext = contexte;
            const modal = document.getElementById('modalCamera');
            const video = document.getElementById('video');

            modal.style.display = 'block';

            navigator.mediaDevices.getUserMedia({ 
                video: { 
                    facingMode: 'environment',
                    width: { ideal: 1280 },
                    height: { ideal: 720 }
                } 
            })
            .then(function(mediaStream) {
                stream = mediaStream;
                video.srcObject = stream;
                console.log('‚úÖ Cam√©ra activ√©e');
            })
            .catch(function(err) {
                console.error('‚ùå Erreur cam√©ra:', err);
                afficherNotification('‚ùå Impossible d\'acc√©der √† la cam√©ra', 'danger');
                fermerCamera();
            });
        }

        function prendrePhoto() {
            console.log('üì∏ Capture photo...');
            const video = document.getElementById('video');
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');

            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            ctx.drawImage(video, 0, 0);
            
            const dataURL = canvas.toDataURL('image/jpeg', 0.8);
            
            if (photoContext === 'ocr') {
                traiterPhotoOCR(dataURL, ocrContext);
            } else {
                ajouterPhoto(dataURL, photoContext);
            }
            
            fermerCamera();
            
            afficherNotification('üì∑ Photo captur√©e avec succ√®s', 'success');
        }

        async function traiterPhotoOCR(dataURL, matierePremiere) {
            console.log('üîç Traitement OCR pour:', matierePremiere);
            
            const mpPhoto = document.getElementById(`photo-${matierePremiere}`);
            const mpItem = document.getElementById(`mp-${matierePremiere}`);
            
            try {
                // Afficher l'image captur√©e
                mpPhoto.innerHTML = `<img src="${dataURL}" alt="Photo ${matierePremiere}">`;
                mpPhoto.classList.remove('ocr-processing');
                mpPhoto.classList.add('ocr-processing');
                
                afficherNotification('üîç Analyse OCR en cours...', 'info');
                
                // Configuration OCR sp√©cialis√©e pour √©tiquettes alimentaires
                const { data: { text } } = await Tesseract.recognize(dataURL, 'fra+eng', {
                    logger: m => console.log(m),
                    tessedit_char_whitelist: '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz/.:-',
                    tessedit_pageseg_mode: Tesseract.PSM.SPARSE_TEXT
                });
                
                console.log('üìù Texte OCR d√©tect√©:', text);
                
                // Extraction intelligente des donn√©es
                const donneesMP = extraireDonneesEtiquette(text);
                
                if (donneesMP.lot || donneesMP.dlc) {
                    // Remplir les champs automatiquement
                    if (donneesMP.lot) {
                        document.getElementById(`lot-${matierePremiere}`).value = donneesMP.lot;
                    }
                    if (donneesMP.dlc) {
                        document.getElementById(`dlc-${matierePremiere}`).value = donneesMP.dlc;
                    }
                    
                    mpPhoto.classList.remove('ocr-processing');
                    mpPhoto.classList.add('ocr-success');
                    mpItem.classList.add('completed');
                    
                    afficherNotification(`‚úÖ OCR r√©ussi pour ${matierePremiere.toUpperCase()}: Lot ${donneesMP.lot}`, 'success');
                } else {
                    throw new Error('Aucune donn√©e exploitable d√©tect√©e');
                }
                
            } catch (error) {
                console.error('‚ùå Erreur OCR:', error);
                
                mpPhoto.classList.remove('ocr-processing');
                mpPhoto.classList.add('ocr-error');
                
                // Permettre la saisie manuelle
                const lot = prompt(`‚ùå OCR √©chou√© pour ${matierePremiere.toUpperCase()}.\nVeuillez saisir le num√©ro de lot manuellement:`);
                if (lot) {
                    document.getElementById(`lot-${matierePremiere}`).value = lot;
                    mpItem.classList.add('completed');
                    afficherNotification(`üìù Lot ${matierePremiere} saisi manuellement`, 'warning');
                } else {
                    mpPhoto.innerHTML = '<span style="font-size: 24px;">üì∑</span>';
                    mpPhoto.classList.remove('ocr-error');
                    afficherNotification(`‚ö†Ô∏è ${matierePremiere.toUpperCase()} non document√©`, 'warning');
                }
            }
            
            verifierBOMCompletude();
        }

        function extraireDonneesEtiquette(texte) {
            const donnees = { lot: null, dlc: null };
            
            // Patterns pour d√©tecter les num√©ros de lot
            const patternsLot = [
                /LOT[:\s]*([A-Z0-9]{6,})/i,
                /BATCH[:\s]*([A-Z0-9]{6,})/i,
                /L[:\s]*([A-Z0-9]{6,})/i,
                /([A-Z]{2}\d{6,})/,
                /(\d{8,}[A-Z]*)/,
                /([A-Z]\d{7,})/
            ];
            
            // Patterns pour d√©tecter les dates (DLC/DLUO)
            const patternsDLC = [
                /DLC[:\s]*(\d{1,2}[\/\.-]\d{1,2}[\/\.-]\d{2,4})/i,
                /DLUO[:\s]*(\d{1,2}[\/\.-]\d{1,2}[\/\.-]\d{2,4})/i,
                /√Ä CONSOMMER AVANT[:\s]*(\d{1,2}[\/\.-]\d{1,2}[\/\.-]\d{2,4})/i,
                /(\d{1,2}[\/\.-]\d{1,2}[\/\.-]\d{2,4})/
            ];
            
            // Recherche num√©ro de lot
            for (const pattern of patternsLot) {
                const match = texte.match(pattern);
                if (match && match[1] && match[1].length >= 4) {
                    donnees.lot = match[1].trim();
                    break;
                }
            }
            
            // Recherche DLC
            for (const pattern of patternsDLC) {
                const match = texte.match(pattern);
                if (match && match[1]) {
                    donnees.dlc = match[1].trim();
                    break;
                }
            }
            
            return donnees;
        }

        function verifierBOMCompletude() {
            const matieresPremierres = ['farine', 'oeuf', 'beurre', 'chocolat'];
            let completees = 0;
            
            matieresPremierres.forEach(mp => {
                const lot = document.getElementById(`lot-${mp}`);
                if (lot && lot.value.trim()) {
                    completees++;
                }
            });
            
            const statusDiv = document.getElementById('bom-status');
            if (statusDiv) {
                if (completees === matieresPremierres.length) {
                    statusDiv.innerHTML = '‚úÖ <strong>BOM compl√®te</strong> - Toutes les mati√®res premi√®res sont document√©es';
                    statusDiv.style.background = '#d4edda';
                    statusDiv.style.color = '#155724';
                } else {
                    statusDiv.innerHTML = `‚ö†Ô∏è <strong>BOM incompl√®te</strong> - ${completees}/${matieresPremierres.length} mati√®res premi√®res document√©es`;
                    statusDiv.style.background = '#fff3cd';
                    statusDiv.style.color = '#856404';
                }
            }
        }

        function fermerCamera() {
            console.log('‚ùå Fermeture cam√©ra');
            const modal = document.getElementById('modalCamera');
            
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
            
            modal.style.display = 'none';
            photoContext = '';
            ocrContext = '';
        }

        function ajouterPhoto(dataURL, contexte) {
            const photoId = 'photo_' + Date.now();
            const previewDiv = document.getElementById(`${contexte}-photos`);
            
            if (previewDiv) {
                const photoDiv = document.createElement('div');
                photoDiv.className = 'photo-item';
                photoDiv.innerHTML = `
                    <img src="${dataURL}" alt="Photo ${contexte}">
                    <button class="photo-delete" onclick="supprimerPhoto('${photoId}', '${contexte}')">√ó</button>
                `;
                photoDiv.id = photoId;
                previewDiv.appendChild(photoDiv);
                
                mettreAJourStatistiques();
            }
        }

        function supprimerPhoto(photoId, contexte) {
            const photoDiv = document.getElementById(photoId);
            if (photoDiv) {
                photoDiv.remove();
                afficherNotification('üóëÔ∏è Photo supprim√©e', 'warning');
                mettreAJourStatistiques();
            }
        }

        // Sauvegarde temp√©ratures
        function sauvegarderTemperatures() {
            console.log('üíæ Sauvegarde temp√©ratures...');
            
            const donneeTemp = {
                id: 'temp_' + Date.now(),
                datetime: document.getElementById('temp-datetime').value,
                responsable: document.getElementById('temp-responsable').value,
                froide: parseFloat(document.getElementById('temp-froide').value) || null,
                negative: parseFloat(document.getElementById('temp-negative').value) || null,
                surgel1: parseFloat(document.getElementById('temp-surgel1').value) || null,
                ambiance: parseFloat(document.getElementById('temp-ambiance').value) || null,
                actions: document.getElementById('temp-actions').value,
                photos: document.getElementById('temp-photos').children.length
            };

            // V√©rifier conformit√©
            donneeTemp.conforme = verifierConformiteTemp(donneeTemp);
            
            // Ajouter aux donn√©es
            donnees.temperatures.unshift(donneeTemp);
            
            // Sauvegarder localement
            sauvegarderDonnees();
            
            // R√©initialiser le formulaire
            reinitialiserFormulaireTemp();
            
            // Recharger tableau
            chargerTableauTemperatures();
            
            // Mettre √† jour stats
            mettreAJourStatistiques();
            
            afficherNotification('‚úÖ Temp√©ratures sauvegard√©es avec succ√®s', 'success');
        }

        function verifierConformiteTemp(donnee) {
            const conformites = [];
            
            if (donnee.froide !== null) {
                conformites.push(Math.abs(donnee.froide - 4.2) <= 1);
            }
            if (donnee.negative !== null) {
                conformites.push(Math.abs(donnee.negative - (-13)) <= 2);
            }
            if (donnee.surgel1 !== null) {
                conformites.push(Math.abs(donnee.surgel1 - (-18)) <= 2);
            }
            if (donnee.ambiance !== null) {
                conformites.push(donnee.ambiance <= 25);
            }
            
            return conformites.length > 0 ? conformites.every(c => c === true) : true;
        }

        function reinitialiserFormulaireTemp() {
            const maintenant = new Date();
            document.getElementById('temp-datetime').value = maintenant.toISOString().slice(0, 16);
            document.getElementById('temp-froide').value = '';
            document.getElementById('temp-negative').value = '';
            document.getElementById('temp-surgel1').value = '';
            document.getElementById('temp-ambiance').value = '';
            document.getElementById('temp-actions').value = '';
            document.getElementById('temp-photos').innerHTML = '';
            
            // Retirer les classes d'alerte
            document.querySelectorAll('.temp-input').forEach(input => {
                input.classList.remove('alert');
            });
        }

        // Sauvegarde production avec BOM
        function sauvegarderProduction() {
            console.log('üíæ Sauvegarde production...');
            
            // V√©rifier BOM compl√®te
            const matieresPremierres = ['farine', 'oeuf', 'beurre', 'chocolat'];
            const bom = {};
            let bomComplete = true;
            
            matieresPremierres.forEach(mp => {
                const lot = document.getElementById(`lot-${mp}`).value;
                const dlc = document.getElementById(`dlc-${mp}`).value;
                const qty = document.getElementById(`qty-${mp}`).value;
                
                if (!lot) {
                    bomComplete = false;
                }
                
                bom[mp] = {
                    lot: lot || null,
                    dlc: dlc || null,
                    quantite: parseFloat(qty) || null
                };
            });
            
            if (!bomComplete) {
                afficherNotification('‚ö†Ô∏è BOM incompl√®te - Veuillez documenter toutes les mati√®res premi√®res', 'warning');
                return;
            }
            
            const donneeProduction = {
                id: 'prod_' + Date.now(),
                lot: document.getElementById('prod-lot').value,
                variete: document.getElementById('prod-variete').value,
                quantite: parseInt(document.getElementById('prod-quantite').value) || 0,
                temperature: parseFloat(document.getElementById('prod-temperature').value) || null,
                bom: bom, // BOM avec tra√ßabilit√© compl√®te
                photos: document.getElementById('prod-photos').children.length,
                datetime: new Date().toISOString()
            };

            if (!donneeProduction.variete || !donneeProduction.quantite) {
                afficherNotification('‚ö†Ô∏è Veuillez remplir les champs obligatoires', 'warning');
                return;
            }
            
            // Ajouter aux donn√©es
            donnees.productions.unshift(donneeProduction);
            
            // Sauvegarder localement
            sauvegarderDonnees();
            
            // R√©initialiser le formulaire
            reinitialiserFormulaireProduction();
            
            // Recharger tableau
            chargerTableauProductions();
            
            // Mettre √† jour stats
            mettreAJourStatistiques();
            
            afficherNotification('‚úÖ Production enregistr√©e avec BOM compl√®te', 'success');
        }

        function genererNumeroLot() {
            const maintenant = new Date();
            const annee = maintenant.getFullYear().toString().slice(-2);
            const mois = (maintenant.getMonth() + 1).toString().padStart(2, '0');
            const jour = maintenant.getDate().toString().padStart(2, '0');
            const heure = maintenant.getHours().toString().padStart(2, '0');
            const minute = maintenant.getMinutes().toString().padStart(2, '0');
            
            const numeroLot = `MC${annee}${mois}${jour}-${heure}${minute}`;
            
            const lotField = document.getElementById('prod-lot');
            if (lotField) {
                lotField.value = numeroLot;
            }
        }

        function reinitialiserFormulaireProduction() {
            genererNumeroLot();
            document.getElementById('prod-variete').value = '';
            document.getElementById('prod-quantite').value = '';
            document.getElementById('prod-temperature').value = '';
            document.getElementById('prod-photos').innerHTML = '';
            
            // R√©initialiser BOM
            const matieresPremierres = ['farine', 'oeuf', 'beurre', 'chocolat'];
            matieresPremierres.forEach(mp => {
                document.getElementById(`lot-${mp}`).value = '';
                document.getElementById(`dlc-${mp}`).value = '';
                document.getElementById(`qty-${mp}`).value = '';
                
                const mpPhoto = document.getElementById(`photo-${mp}`);
                const mpItem = document.getElementById(`mp-${mp}`);
                
                mpPhoto.innerHTML = '<span style="font-size: 24px;">üì∑</span>';
                mpPhoto.className = 'mp-photo';
                mpItem.classList.remove('completed');
            });
            
            verifierBOMCompletude();
        }

        // Sauvegarde nettoyage
        function sauvegarderNettoyage() {
            console.log('üíæ Sauvegarde nettoyage...');
            
            const zones = [];
            const checkboxes = [
                { id: 'nett-plan-travail', label: 'Plans de travail' },
                { id: 'nett-equipements', label: '√âquipements' },
                { id: 'nett-sols', label: 'Sols' },
                { id: 'nett-murs', label: 'Murs' },
                { id: 'nett-frigo-positif', label: 'Frigo positif' },
                { id: 'nett-congelateurs', label: 'Cong√©lateurs' },
                { id: 'nett-joints', label: 'Joints' }
            ];
            
            checkboxes.forEach(cb => {
                const checkbox = document.getElementById(cb.id);
                if (checkbox && checkbox.checked) {
                    zones.push(cb.label);
                }
            });
            
            const donneeNettoyage = {
                id: 'nett_' + Date.now(),
                date: document.getElementById('nettoyage-date').value,
                responsable: document.getElementById('nettoyage-responsable').value,
                zones: zones,
                produits: document.getElementById('nett-produits').value,
                photos: document.getElementById('nettoyage-photos').children.length,
                datetime: new Date().toISOString()
            };
            
            if (zones.length === 0) {
                afficherNotification('‚ö†Ô∏è Veuillez s√©lectionner au moins une zone √† nettoyer', 'warning');
                return;
            }
            
            // Ajouter aux donn√©es
            donnees.nettoyages.unshift(donneeNettoyage);
            
            // Sauvegarder localement
            sauvegarderDonnees();
            
            // R√©initialiser le formulaire
            reinitialiserFormulaireNettoyage();
            
            // Recharger tableau
            chargerTableauNettoyage();
            
            afficherNotification('‚úÖ Plan de nettoyage valid√©', 'success');
        }

        function reinitialiserFormulaireNettoyage() {
            const maintenant = new Date();
            document.getElementById('nettoyage-date').value = maintenant.toISOString().slice(0, 10);
            document.getElementById('nett-produits').value = '';
            document.getElementById('nettoyage-photos').innerHTML = '';
            
            // D√©cocher toutes les cases
            const checkboxes = document.querySelectorAll('#content-nettoyage input[type="checkbox"]');
            checkboxes.forEach(cb => cb.checked = false);
        }

        // Sauvegarde r√©ception
        function sauvegarderReception() {
            console.log('üíæ Sauvegarde r√©ception...');
            
            const controles = [];
            const checkboxes = [
                { id: 'recep-temperature', label: 'Temp√©rature' },
                { id: 'recep-emballage', label: 'Emballage' },
                { id: 'recep-dlc', label: 'DLC/DLUO' },
                { id: 'recep-quantite', label: 'Quantit√©' },
                { id: 'recep-aspect', label: 'Aspect visuel' }
            ];
            
            checkboxes.forEach(cb => {
                const checkbox = document.getElementById(cb.id);
                if (checkbox && checkbox.checked) {
                    controles.push(cb.label);
                }
            });
            
            const donneeReception = {
                id: 'recep_' + Date.now(),
                datetime: document.getElementById('recep-datetime').value,
                fournisseur: document.getElementById('recep-fournisseur').value,
                bon: document.getElementById('recep-bon').value,
                transporteur: document.getElementById('recep-transporteur').value,
                produits: document.getElementById('recep-produits').value,
                controles: controles,
                observations: document.getElementById('recep-observations').value,
                photos: document.getElementById('reception-photos').children.length,
                conforme: controles.length >= 3 // Au moins 3 contr√¥les pour √™tre conforme
            };
            
            if (!donneeReception.fournisseur || !donneeReception.produits) {
                afficherNotification('‚ö†Ô∏è Veuillez remplir les champs obligatoires', 'warning');
                return;
            }
            
            // Ajouter aux donn√©es
            donnees.receptions.unshift(donneeReception);
            
            // Sauvegarder localement
            sauvegarderDonnees();
            
            // R√©initialiser le formulaire
            reinitialiserFormulaireReception();
            
            // Recharger tableau
            chargerTableauReceptions();
            
            afficherNotification('‚úÖ R√©ception enregistr√©e', 'success');
        }

        function reinitialiserFormulaireReception() {
            const maintenant = new Date();<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PMS MADAME COOKIES v2.0</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 10px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 20px;
            border-radius: 20px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .logo h1 {
            color: #2c3e50;
            font-size: 24px;
            font-weight: 800;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .user-info {
            color: #7f8c8d;
            font-size: 14px;
            margin-top: 8px;
        }

        .nav-tabs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .nav-tab {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 15px;
            padding: 15px 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 700;
            color: #7f8c8d;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            min-height: 80px;
        }

        .nav-tab:hover {
            background: rgba(255, 255, 255, 1);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .nav-icon {
            font-size: 24px;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .card-title {
            font-size: 22px;
            font-weight: 800;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 12px 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 700;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #55efc4, #00b894);
        }

        .btn-primary {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-left: 5px solid;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.15);
        }

        .stat-number {
            font-size: 36px;
            font-weight: 900;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 14px;
            text-transform: uppercase;
            font-weight: 700;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-label {
            font-weight: 700;
            margin-bottom: 10px;
            color: #2c3e50;
            font-size: 14px;
        }

        .form-input, .form-select, textarea {
            padding: 15px;
            border: 2px solid #e1e8ed;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
        }

        .form-input:focus, .form-select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        .temp-input.alert {
            background: #fee;
            border-color: #dc3545;
            animation: shake 0.5s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            75% { transform: translateX(8px); }
        }

        .photo-upload {
            border: 3px dashed #e1e8ed;
            border-radius: 15px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            margin: 20px 0;
        }

        .photo-upload:hover {
            border-color: #667eea;
            background: linear-gradient(135deg, #f0f8ff, #e6f3ff);
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
        }

        .photo-icon {
            font-size: 48px;
            margin-bottom: 15px;
            display: block;
        }

        .photo-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .photo-item {
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .photo-item:hover {
            transform: scale(1.05);
        }

        .photo-item img {
            width: 100%;
            height: 100px;
            object-fit: cover;
        }

        .photo-delete {
            position: absolute;
            top: 8px;
            right: 8px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .data-table th,
        .data-table td {
            padding: 15px 10px;
            text-align: left;
            border-bottom: 1px solid #e1e8ed;
        }

        .data-table th {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            font-weight: 700;
            color: #2c3e50;
        }

        .data-table tr:hover {
            background: rgba(102, 126, 234, 0.05);
        }

        .status-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .status-conforme {
            background: #d4edda;
            color: #155724;
        }

        .status-non-conforme {
            background: #f8d7da;
            color: #721c24;
        }

        .alert {
            padding: 20px;
            margin: 20px 0;
            border-radius: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 15px;
            animation: slideIn 0.3s ease;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left: 5px solid #28a745;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border-left: 5px solid #ffc107;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border-left: 5px solid #dc3545;
        }

        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            margin: 10% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            position: relative;
            animation: slideInModal 0.3s ease;
        }

        @keyframes slideInModal {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .close {
            position: absolute;
            right: 20px;
            top: 20px;
            color: #aaa;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: #f8f9fa;
        }

        .close:hover {
            color: #000;
            background: #e9ecef;
        }

        #video {
            width: 100%;
            max-width: 400px;
            border-radius: 12px;
            margin: 20px auto;
            display: block;
        }

        #canvas {
            display: none;
        }

        .camera-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 2000;
            max-width: 400px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            animation: slideInNotif 0.3s ease;
        }

        @keyframes slideInNotif {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Mati√®res Premi√®res */
        .mp-item {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 15px;
            align-items: center;
            padding: 15px;
            border: 2px dashed #d0d5dd;
            border-radius: 12px;
            background: #fff;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .mp-item:hover {
            border-color: #667eea;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        .mp-item.completed {
            border-color: #28a745;
            background: #f8fff8;
        }

        .mp-item .mp-info {
            flex: 1;
        }

        .mp-item .mp-fields {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 10px 0;
        }

        .mp-item .mp-actions {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .mp-photo {
            width: 80px;
            height: 60px;
            border-radius: 8px;
            background: #f4f6fb;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border: 2px solid #e5e7eb;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mp-photo:hover {
            border-color: #667eea;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
            transform: scale(1.05);
        }

        .mp-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .mp-photo.completed {
            border-color: #28a745;
            background: #d4edda;
        }

        .required {
            color: #d92d20;
            font-weight: 700;
            font-size: 10px;
            text-transform: uppercase;
        }

        .ocr-processing {
            background: #fff3cd !important;
            border-color: #ffc107 !important;
            animation: pulse 2s infinite;
        }

        .ocr-success {
            background: #d4edda !important;
            border-color: #28a745 !important;
        }

        .ocr-error {
            background: #f8d7da !important;
            border-color: #dc3545 !important;
        });
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <div class="header">
            <div class="logo">
                <h1>üç™ MADAME COOKIES PMS</h1>
                <div class="user-info">
                    <span>Wendy JEAN MARIE</span> ‚Ä¢ 
                    <span id="current-date"></span>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="nav-tabs">
            <button class="nav-tab active" id="tab-dashboard">
                <span class="nav-icon">üìä</span>
                <span>Tableau</span>
            </button>
            <button class="nav-tab" id="tab-temperatures">
                <span class="nav-icon">üå°Ô∏è</span>
                <span>Temp√©ratures</span>
            </button>
            <button class="nav-tab" id="tab-production">
                <span class="nav-icon">üè≠</span>
                <span>Production</span>
            </button>
            <button class="nav-tab" id="tab-nettoyage">
                <span class="nav-icon">üßΩ</span>
                <span>Nettoyage</span>
            </button>
            <button class="nav-tab" id="tab-reception">
                <span class="nav-icon">üì¶</span>
                <span>R√©ception</span>
            </button>
            <button class="nav-tab" id="tab-historique">
                <span class="nav-icon">üìã</span>
                <span>Historique</span>
            </button>
            <button class="nav-tab" id="tab-exports">
                <span class="nav-icon">üìÑ</span>
                <span>Exports</span>
            </button>
        </div>

        <!-- Tableau de Bord -->
        <div class="tab-content active" id="content-dashboard">
            <div class="stats-grid">
                <div class="stat-card" style="border-left-color: #28a745;">
                    <div class="stat-number" id="stat-conformes">0</div>
                    <div class="stat-label">Contr√¥les OK</div>
                </div>
                <div class="stat-card" style="border-left-color: #dc3545;">
                    <div class="stat-number" id="stat-non-conformes">0</div>
                    <div class="stat-label">Non-Conformit√©s</div>
                </div>
                <div class="stat-card" style="border-left-color: #ffc107;">
                    <div class="stat-number" id="stat-productions">0</div>
                    <div class="stat-label">Lots Produits</div>
                </div>
                <div class="stat-card" style="border-left-color: #17a2b8;">
                    <div class="stat-number" id="stat-photos">0</div>
                    <div class="stat-label">Photos Prises</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üö® Statut du Jour</h2>
                </div>
                <div class="alert alert-success">
                    <span>‚úÖ</span> 
                    <div>Syst√®me op√©rationnel - Pr√™t pour les contr√¥les</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üìÖ Actions Recommand√©es</h2>
                </div>
                <div>
                    <p style="color: #666; margin-bottom: 15px;">Cochez les t√¢ches accomplies :</p>
                    <div style="display: grid; gap: 10px;">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                            <input type="checkbox"> <strong>08:00</strong> - Contr√¥le temp√©ratures √©quipements
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                            <input type="checkbox"> <strong>09:00</strong> - Saisie production du jour
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                            <input type="checkbox"> <strong>12:00</strong> - Second contr√¥le temp√©ratures
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                            <input type="checkbox"> <strong>13:00</strong> - Plan de nettoyage quotidien
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contr√¥le Temp√©ratures -->
        <div class="tab-content" id="content-temperatures">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üå°Ô∏è Contr√¥le Temp√©ratures</h2>
                    <button class="btn btn-success" onclick="sauvegarderTemperatures()">
                        üíæ Sauvegarder
                    </button>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Date et Heure</label>
                        <input type="datetime-local" class="form-input" id="temp-datetime">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Responsable</label>
                        <select class="form-select" id="temp-responsable">
                            <option>Wendy JEAN MARIE</option>
                            <option>√âquipe Production</option>
                            <option>Nylaime MAMODALY BANDJEE</option>
                        </select>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">üßä Unit√© froide +2 portes<br><small style="color: #666;">(Cible: 4,2¬∞C ¬± 1¬∞C)</small></label>
                        <input type="number" step="0.1" class="form-input temp-input" id="temp-froide" 
                               placeholder="Ex: 4.2" onchange="verifierTemperature(this, 4.2, 1)">
                    </div>
                    <div class="form-group">
                        <label class="form-label">‚ùÑÔ∏è Unit√© n√©gative<br><small style="color: #666;">(Cible: -13¬∞C ¬± 2¬∞C)</small></label>
                        <input type="number" step="0.1" class="form-input temp-input" id="temp-negative" 
                               placeholder="Ex: -13.0" onchange="verifierTemperature(this, -13, 2)">
                    </div>
                    <div class="form-group">
                        <label class="form-label">üßä Surg√©lateur 1<br><small style="color: #666;">(Cible: -18¬∞C ¬± 2¬∞C)</small></label>
                        <input type="number" step="0.1" class="form-input temp-input" id="temp-surgel1" 
                               placeholder="Ex: -18.0" onchange="verifierTemperature(this, -18, 2)">
                    </div>
                    <div class="form-group">
                        <label class="form-label">üå°Ô∏è Ambiance atelier<br><small style="color: #666;">(Max: 25¬∞C)</small></label>
                        <input type="number" step="0.1" class="form-input temp-input" id="temp-ambiance" 
                               placeholder="Ex: 22.0" onchange="verifierTemperature(this, 25, 0, 'max')">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Actions correctives (si n√©cessaire)</label>
                    <textarea class="form-input" id="temp-actions" rows="3" 
                              placeholder="D√©crire les actions prises en cas de temp√©rature non conforme..."></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">üì∑ Photos √©quipements</label>
                    <div class="photo-upload" onclick="ouvrirCamera('temperatures')">
                        <span class="photo-icon">üì∑</span>
                        <div><strong>Prendre une photo</strong></div>
                        <div style="color: #666; margin-top: 8px;">√âquipements de froid</div>
                    </div>
                    <div class="photo-preview" id="temp-photos"></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üìä Derniers Contr√¥les</h2>
                    <button class="btn btn-primary" onclick="exporterTemperaturesPDF()">
                        üìÑ Export PDF
                    </button>
                </div>
                <div style="overflow-x: auto;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Date/Heure</th>
                                <th>Responsable</th>
                                <th>Froide</th>
                                <th>N√©gative</th>
                                <th>Surg√©l.1</th>
                                <th>Ambiance</th>
                                <th>Statut</th>
                            </tr>
                        </thead>
                        <tbody id="table-temperatures">
                            <tr>
                                <td colspan="7" style="text-align: center; color: #666; padding: 30px;">
                                    Aucun contr√¥le enregistr√©
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Production -->
        <div class="tab-content" id="content-production">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üè≠ Nouvelle Production</h2>
                    <button class="btn btn-success" onclick="sauvegarderProduction()">
                        üíæ Enregistrer
                    </button>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">N¬∞ Lot (auto-g√©n√©r√©)</label>
                        <input type="text" class="form-input" id="prod-lot" readonly>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Vari√©t√© Cookie</label>
                        <select class="form-select" id="prod-variete">
                            <option value="">-- Choisir une vari√©t√© --</option>
                            <option>LAIT</option>
                            <option>NOIR</option>
                            <option>3 CHOCOLAT</option>
                            <option>FULL</option>
                            <option>NATURE</option>
                            <option>KINDER</option>
                            <option>SNICKERS</option>
                            <option>MATCHA</option>
                            <option>M&MS</option>
                            <option>NOISETTES</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Quantit√© (pi√®ces)</label>
                        <input type="number" class="form-input" id="prod-quantite" placeholder="Ex: 250">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Temp√©rature Cuisson (¬∞C)</label>
                        <input type="number" class="form-input" id="prod-temperature" placeholder="160-180¬∞C">
                    </div>
                </div>

                <!-- Section Mati√®res Premi√®res avec OCR -->
                <div class="card" style="background: linear-gradient(135deg, #e8f5e8, #f0f8f0); border: 2px solid #28a745;">
                    <div class="card-header">
                        <h3 class="card-title">üßæ Mati√®res Premi√®res - Tra√ßabilit√© OCR</h3>
                        <div style="background: #28a745; color: white; padding: 5px 10px; border-radius: 15px; font-size: 12px; font-weight: bold;">
                            ‚ö†Ô∏è OBLIGATOIRE
                        </div>
                    </div>
                    
                    <div class="alert" style="background: #d1ecf1; color: #0c5460; border-left: 4px solid #17a2b8;">
                        <span>‚ÑπÔ∏è</span>
                        <div>Photographiez <strong>chaque √©tiquette</strong> de mati√®re premi√®re. Le syst√®me d√©tectera automatiquement les num√©ros de lot via OCR.</div>
                    </div>

                    <!-- Liste des mati√®res premi√®res -->
                    <div id="matieres-premieres-container">
                        <!-- Farine -->
                        <div class="mp-item" id="mp-farine">
                            <div class="mp-info">
                                <h4 style="color: #8B4513; margin-bottom: 10px;">üåæ FARINE</h4>
                                <div class="mp-fields">
                                    <div>
                                        <label style="font-size: 12px; color: #666;">N¬∞ Lot d√©tect√©</label>
                                        <input type="text" class="form-input" id="lot-farine" readonly placeholder="En attente OCR...">
                                    </div>
                                    <div>
                                        <label style="font-size: 12px; color: #666;">DLC d√©tect√©e</label>
                                        <input type="text" class="form-input" id="dlc-farine" readonly placeholder="En attente OCR...">
                                    </div>
                                </div>
                                <div style="margin-top: 10px;">
                                    <label style="font-size: 12px; color: #666;">Quantit√© utilis√©e (kg)</label>
                                    <input type="number" step="0.1" class="form-input" id="qty-farine" placeholder="Ex: 2.5" style="max-width: 120px;">
                                </div>
                            </div>
                            <div class="mp-actions">
                                <div class="mp-photo" onclick="ouvrirCameraOCR('farine')" id="photo-farine">
                                    <span style="font-size: 24px;">üì∑</span>
                                </div>
                                <div style="font-size: 12px; text-align: center; margin-top: 5px;">
                                    <span class="required">REQUIS</span>
                                </div>
                            </div>
                        </div>

                        <!-- Oeufs -->
                        <div class="mp-item" id="mp-oeuf">
                            <div class="mp-info">
                                <h4 style="color: #FFA500; margin-bottom: 10px;">ü•ö OEUFS</h4>
                                <div class="mp-fields">
                                    <div>
                                        <label style="font-size: 12px; color: #666;">N¬∞ Lot d√©tect√©</label>
                                        <input type="text" class="form-input" id="lot-oeuf" readonly placeholder="En attente OCR...">
                                    </div>
                                    <div>
                                        <label style="font-size: 12px; color: #666;">DLC d√©tect√©e</label>
                                        <input type="text" class="form-input" id="dlc-oeuf" readonly placeholder="En attente OCR...">
                                    </div>
                                </div>
                                <div style="margin-top: 10px;">
                                    <label style="font-size: 12px; color: #666;">Quantit√© utilis√©e (unit√©s)</label>
                                    <input type="number" class="form-input" id="qty-oeuf" placeholder="Ex: 6" style="max-width: 120px;">
                                </div>
                            </div>
                            <div class="mp-actions">
                                <div class="mp-photo" onclick="ouvrirCameraOCR('oeuf')" id="photo-oeuf">
                                    <span style="font-size: 24px;">üì∑</span>
                                </div>
                                <div style="font-size: 12px; text-align: center; margin-top: 5px;">
                                    <span class="required">REQUIS</span>
                                </div>
                            </div>
                        </div>

                        <!-- Beurre -->
                        <div class="mp-item" id="mp-beurre">
                            <div class="mp-info">
                                <h4 style="color: #FFD700; margin-bottom: 10px;">üßà BEURRE</h4>
                                <div class="mp-fields">
                                    <div>
                                        <label style="font-size: 12px; color: #666;">N¬∞ Lot d√©tect√©</label>
                                        <input type="text" class="form-input" id="lot-beurre" readonly placeholder="En attente OCR...">
                                    </div>
                                    <div>
                                        <label style="font-size: 12px; color: #666;">DLC d√©tect√©e</label>
                                        <input type="text" class="form-input" id="dlc-beurre" readonly placeholder="En attente OCR...">
                                    </div>
                                </div>
                                <div style="margin-top: 10px;">
                                    <label style="font-size: 12px; color: #666;">Quantit√© utilis√©e (g)</label>
                                    <input type="number" class="form-input" id="qty-beurre" placeholder="Ex: 500" style="max-width: 120px;">
                                </div>
                            </div>
                            <div class="mp-actions">
                                <div class="mp-photo" onclick="ouvrirCameraOCR('beurre')" id="photo-beurre">
                                    <span style="font-size: 24px;">üì∑</span>
                                </div>
                                <div style="font-size: 12px; text-align: center; margin-top: 5px;">
                                    <span class="required">REQUIS</span>
                                </div>
                            </div>
                        </div>

                        <!-- Chocolat -->
                        <div class="mp-item" id="mp-chocolat">
                            <div class="mp-info">
                                <h4 style="color: #8B4513; margin-bottom: 10px;">üç´ CHOCOLAT</h4>
                                <div class="mp-fields">
                                    <div>
                                        <label style="font-size: 12px; color: #666;">N¬∞ Lot d√©tect√©</label>
                                        <input type="text" class="form-input" id="lot-chocolat" readonly placeholder="En attente OCR...">
                                    </div>
                                    <div>
                                        <label style="font-size: 12px; color: #666;">DLC d√©tect√©e</label>
                                        <input type="text" class="form-input" id="dlc-chocolat" readonly placeholder="En attente OCR...">
                                    </div>
                                </div>
                                <div style="margin-top: 10px;">
                                    <label style="font-size: 12px; color: #666;">Quantit√© utilis√©e (g)</label>
                                    <input type="number" class="form-input" id="qty-chocolat" placeholder="Ex: 300" style="max-width: 120px;">
                                </div>
                            </div>
                            <div class="mp-actions">
                                <div class="mp-photo" onclick="ouvrirCameraOCR('chocolat')" id="photo-chocolat">
                                    <span style="font-size: 24px;">üì∑</span>
                                </div>
                                <div style="font-size: 12px; text-align: center; margin-top: 5px;">
                                    <span class="required">REQUIS</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Statut validation BOM -->
                    <div id="bom-status" style="margin-top: 20px; padding: 15px; border-radius: 10px; text-align: center; background: #f8d7da; color: #721c24;">
                        ‚ö†Ô∏è <strong>BOM incompl√®te</strong> - Veuillez photographier toutes les mati√®res premi√®res
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">üì∑ Photos production (finales)</label>
                    <div class="photo-upload" onclick="ouvrirCamera('production')">
                        <span class="photo-icon">üì∑</span>
                        <div><strong>Photographier le lot final</strong></div>
                        <div style="color: #666; margin-top: 8px;">Avant/pendant/apr√®s cuisson</div>
                    </div>
                    <div class="photo-preview" id="prod-photos"></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üìä Productions du Jour</h2>
                </div>
                <div style="overflow-x: auto;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>N¬∞ Lot</th>
                                <th>Vari√©t√©</th>
                                <th>Quantit√©</th>
                                <th>Temp√©rature</th>
                                <th>Statut</th>
                            </tr>
                        </thead>
                        <tbody id="table-productions">
                            <tr>
                                <td colspan="5" style="text-align: center; color: #666; padding: 30px;">
                                    Aucune production enregistr√©e
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Nettoyage -->
        <div class="tab-content" id="content-nettoyage">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üßΩ Plan de Nettoyage</h2>
                    <button class="btn btn-success" onclick="sauvegarderNettoyage()">
                        üíæ Valider Plan
                    </button>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Date</label>
                        <input type="date" class="form-input" id="nettoyage-date">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Responsable</label>
                        <select class="form-select" id="nettoyage-responsable">
                            <option>Wendy JEAN MARIE</option>
                            <option>√âquipe Production</option>
                            <option>Personnel Nettoyage</option>
                        </select>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">üè≠ Zones de Production</h3>
                    <div style="display: grid; gap: 10px; margin: 15px 0;">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                            <input type="checkbox" id="nett-plan-travail"> <strong>Plans de travail</strong> - D√©sinfection surfaces
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                            <input type="checkbox" id="nett-equipements"> <strong>√âquipements</strong> - Mixeurs, fours, ustensiles
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                            <input type="checkbox" id="nett-sols"> <strong>Sols</strong> - Balayage et lavage
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                            <input type="checkbox" id="nett-murs"> <strong>Murs et carrelage</strong> - D√©graissage
                        </label>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">‚ùÑÔ∏è Zones Froides</h3>
                    <div style="display: grid; gap: 10px; margin: 15px 0;">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                            <input type="checkbox" id="nett-frigo-positif"> <strong>Frigo positif</strong> - Int√©rieur et ext√©rieur
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                            <input type="checkbox" id="nett-congelateurs"> <strong>Cong√©lateurs</strong> - D√©givrage si n√©cessaire
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                            <input type="checkbox" id="nett-joints"> <strong>Joints d'√©tanch√©it√©</strong> - V√©rification √©tat
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Produits utilis√©s</label>
                    <textarea class="form-input" id="nett-produits" rows="2" 
                              placeholder="D√©tergents, d√©sinfectants utilis√©s..."></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">üì∑ Photos avant/apr√®s</label>
                    <div class="photo-upload" onclick="ouvrirCamera('nettoyage')">
                        <span class="photo-icon">üì∑</span>
                        <div><strong>Documenter le nettoyage</strong></div>
                        <div style="color: #666; margin-top: 8px;">Photos de contr√¥le</div>
                    </div>
                    <div class="photo-preview" id="nettoyage-photos"></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üìÖ Historique Nettoyage</h2>
                </div>
                <div style="overflow-x: auto;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Responsable</th>
                                <th>Zones trait√©es</th>
                                <th>Produits</th>
                                <th>Statut</th>
                            </tr>
                        </thead>
                        <tbody id="table-nettoyage">
                            <tr>
                                <td colspan="5" style="text-align: center; color: #666; padding: 30px;">
                                    Aucun nettoyage enregistr√©
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="tab-content" id="content-reception">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üì¶ R√©ception Marchandises</h2>
                    <button class="btn btn-success" onclick="sauvegarderReception()">
                        üíæ Enregistrer
                    </button>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Date/Heure r√©ception</label>
                        <input type="datetime-local" class="form-input" id="recep-datetime">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Fournisseur</label>
                        <input type="text" class="form-input" id="recep-fournisseur" 
                               placeholder="Nom du fournisseur">
                    </div>
                    <div class="form-group">
                        <label class="form-label">N¬∞ Bon de livraison</label>
                        <input type="text" class="form-input" id="recep-bon" 
                               placeholder="R√©f√©rence BL">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Transporteur</label>
                        <input type="text" class="form-input" id="recep-transporteur" 
                               placeholder="Soci√©t√© de transport">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Produits re√ßus</label>
                    <textarea class="form-input" id="recep-produits" rows="3" 
                              placeholder="D√©tail des marchandises re√ßues..."></textarea>
                </div>

                <div class="card">
                    <h3 class="card-title">üîç Contr√¥les Qualit√©</h3>
                    <div style="display: grid; gap: 10px; margin: 15px 0;">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                            <input type="checkbox" id="recep-temperature"> <strong>Temp√©rature</strong> - Respect cha√Æne du froid
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                            <input type="checkbox" id="recep-emballage"> <strong>Emballage</strong> - √âtat, int√©grit√©
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                            <input type="checkbox" id="recep-dlc"> <strong>DLC/DLUO</strong> - V√©rification dates
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                            <input type="checkbox" id="recep-quantite"> <strong>Quantit√©</strong> - Conformit√© commande
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                            <input type="checkbox" id="recep-aspect"> <strong>Aspect visuel</strong> - Couleur, odeur
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Observations / Non-conformit√©s</label>
                    <textarea class="form-input" id="recep-observations" rows="3" 
                              placeholder="Remarques, anomalies d√©tect√©es..."></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">üì∑ Photos r√©ception</label>
                    <div class="photo-upload" onclick="ouvrirCamera('reception')">
                        <span class="photo-icon">üì∑</span>
                        <div><strong>Photographier la livraison</strong></div>
                        <div style="color: #666; margin-top: 8px;">Produits, √©tiquetage, BL</div>
                    </div>
                    <div class="photo-preview" id="reception-photos"></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üìä R√©ceptions R√©centes</h2>
                </div>
                <div style="overflow-x: auto;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Fournisseur</th>
                                <th>N¬∞ BL</th>
                                <th>Contr√¥les</th>
                                <th>Statut</th>
                            </tr>
                        </thead>
                        <tbody id="table-receptions">
                            <tr>
                                <td colspan="5" style="text-align: center; color: #666; padding: 30px;">
                                    Aucune r√©ception enregistr√©e
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="tab-content" id="content-historique">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üìã Historique Complet</h2>
                </div>
                <div style="overflow-x: auto;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Date/Heure</th>
                                <th>Type</th>
                                <th>Responsable</th>
                                <th>D√©tails</th>
                                <th>Statut</th>
                            </tr>
                        </thead>
                        <tbody id="table-historique">
                            <tr>
                                <td colspan="5" style="text-align: center; color: #666; padding: 30px;">
                                    Aucune donn√©e disponible
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="tab-content" id="content-exports">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üìÑ Exports et Rapports</h2>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Type de rapport</label>
                        <select class="form-select">
                            <option>Rapport complet</option>
                            <option>Temp√©ratures uniquement</option>
                            <option>Production uniquement</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">P√©riode</label>
                        <select class="form-select">
                            <option>Aujourd'hui</option>
                            <option>7 derniers jours</option>
                            <option>30 derniers jours</option>
                        </select>
                    </div>
                </div>

                <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-top: 20px;">
                    <button class="btn btn-success" onclick="genererRapportPDF()">
                        üìÑ G√©n√©rer PDF
                    </button>
                    <button class="btn btn-primary" onclick="exporterExcel()">
                        üìä Export Excel
                    </button>
                    <button class="btn" onclick="sauvegarderLocal()">
                        üíæ Sauvegarde locale
                    </button>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üìà Statistiques Rapides</h2>
                </div>
                <div class="stats-grid">
                    <div class="stat-card" style="border-left-color: #28a745;">
                        <div class="stat-number">95%</div>
                        <div class="stat-label">Taux Conformit√©</div>
                    </div>
                    <div class="stat-card" style="border-left-color: #17a2b8;">
                        <div class="stat-number">4.1¬∞C</div>
                        <div class="stat-label">Temp. Moyenne</div>
                    </div>
                    <div class="stat-card" style="border-left-color: #ffc107;">
                        <div class="stat-number">847</div>
                        <div class="stat-label">Cookies/Semaine</div>
                    </div>
                    <div class="stat-card" style="border-left-color: #6c757d;">
                        <div class="stat-number">2</div>
                        <div class="stat-label">Incidents Mois</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Cam√©ra -->
    <div id="modalCamera" class="modal">
        <div class="modal-content">
            <span class="close" onclick="fermerCamera()">&times;</span>
            <h2 style="margin-bottom: 20px; text-align: center;">üì∑ Prendre une photo</h2>
            <video id="video" autoplay playsinline></video>
            <canvas id="canvas"></canvas>
            <div class="camera-controls">
                <button class="btn btn-success" onclick="prendrePhoto()">
                    üì∏ Capturer
                </button>
                <button class="btn" onclick="fermerCamera()" style="background: #6c757d;">
                    ‚ùå Annuler
                </button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        // Variables globales
        let currentTab = 'dashboard';
        let stream = null;
        let photoContext = '';
        let donnees = {
            temperatures: [],
            productions: [],
            actions: {}
        };

        // Initialisation au chargement
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üç™ Initialisation PMS Madame Cookies...');
            
            // Date actuelle
            const maintenant = new Date();
            document.getElementById('current-date').textContent = 
                maintenant.toLocaleDateString('fr-FR', {
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric'
                });

            // Initialiser les champs date/heure
            const tempDatetime = document.getElementById('temp-datetime');
            if (tempDatetime) {
                tempDatetime.value = maintenant.toISOString().slice(0, 16);
            }

            // G√©n√©rer num√©ro de lot
            genererNumeroLot();

            // Initialiser navigation
            initNavigation();

            // Charger donn√©es
            chargerDonnees();
            mettreAJourStatistiques();

            console.log('‚úÖ Application initialis√©e');
        });

        // Navigation
        function initNavigation() {
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.id.replace('tab-', '');
                    changerTab(tabId);
                });
            });
        }

        function changerTab(tabId) {
            console.log('üîÑ Changement onglet vers:', tabId);
            
            // Masquer tous les contenus
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // D√©sactiver tous les boutons
            document.querySelectorAll('.nav-tab').forEach(btn => {
                btn.classList.remove('active');
            });

            // Activer le nouveau contenu et bouton
            const targetContent = document.getElementById('content-' + tabId);
            const targetButton = document.getElementById('tab-' + tabId);

            if (targetContent && targetButton) {
                targetContent.classList.add('active');
                targetButton.classList.add('active');
                currentTab = tabId;
                
                // Charger donn√©es sp√©cifiques si n√©cessaire
                switch(tabId) {
                    case 'temperatures':
                        chargerTableauTemperatures();
                        break;
                    case 'production':
                        chargerTableauProductions();
                        break;
                    case 'historique':
                        chargerHistorique();
                        break;
                }

                afficherNotification(`‚úÖ Module ${getTabName(tabId)} activ√©`, 'success');
            } else {
                console.error('‚ùå Onglet introuvable:', tabId);
            }
        }

        function getTabName(tabId) {
            const names = {
                'dashboard': 'Tableau de Bord',
                'temperatures': 'Temp√©ratures',
                'production': 'Production',
                'nettoyage': 'Nettoyage',
                'reception': 'R√©ception',
                'historique': 'Historique',
                'exports': 'Exports'
            };
            return names[tabId] || tabId;
        }

        // V√©rification temp√©rature
        function verifierTemperature(input, cible, tolerance, type = 'range') {
            const valeur = parseFloat(input.value);
            if (isNaN(valeur)) return;

            input.classList.remove('alert');
            
            let conforme = false;
            if (type === 'max') {
                conforme = valeur <= cible;
            } else {
                conforme = Math.abs(valeur - cible) <= tolerance;
            }

            if (!conforme) {
                input.classList.add('alert');
                afficherNotification(`‚ö†Ô∏è Temp√©rature non conforme: ${valeur}¬∞C`, 'warning');
            } else {
                afficherNotification(`‚úÖ Temp√©rature conforme: ${valeur}¬∞C`, 'success');
            }
        }

        // Gestion cam√©ra
        function ouvrirCamera(contexte) {
            console.log('üì∑ Ouverture cam√©ra pour:', contexte);
            photoContext = contexte;
            const modal = document.getElementById('modalCamera');
            const video = document.getElementById('video');

            modal.style.display = 'block';

            navigator.mediaDevices.getUserMedia({ 
                video: { 
                    facingMode: 'environment',
                    width: { ideal: 1280 },
                    height: { ideal: 720 }
                } 
            })
            .then(function(mediaStream) {
                stream = mediaStream;
                video.srcObject = stream;
                console.log('‚úÖ Cam√©ra activ√©e');
            })
            .catch(function(err) {
                console.error('‚ùå Erreur cam√©ra:', err);
                afficherNotification('‚ùå Impossible d\'acc√©der √† la cam√©ra', 'danger');
                fermerCamera();
            });
        }

        function prendrePhoto() {
            console.log('üì∏ Capture photo...');
            const video = document.getElementById('video');
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');

            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            ctx.drawImage(video, 0, 0);
            
            const dataURL = canvas.toDataURL('image/jpeg', 0.8);
            ajouterPhoto(dataURL, photoContext);
            fermerCamera();
            
            afficherNotification('üì∑ Photo captur√©e avec succ√®s', 'success');
        }

        function fermerCamera() {
            console.log('‚ùå Fermeture cam√©ra');
            const modal = document.getElementById('modalCamera');
            
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
            
            modal.style.display = 'none';
        }

        function ajouterPhoto(dataURL, contexte) {
            const photoId = 'photo_' + Date.now();
            const previewDiv = document.getElementById(`${contexte}-photos`);
            
            if (previewDiv) {
                const photoDiv = document.createElement('div');
                photoDiv.className = 'photo-item';
                photoDiv.innerHTML = `
                    <img src="${dataURL}" alt="Photo ${contexte}">
                    <button class="photo-delete" onclick="supprimerPhoto('${photoId}', '${contexte}')">√ó</button>
                `;
                photoDiv.id = photoId;
                previewDiv.appendChild(photoDiv);
                
                mettreAJourStatistiques();
            }
        }

        function supprimerPhoto(photoId, contexte) {
            const photoDiv = document.getElementById(photoId);
            if (photoDiv) {
                photoDiv.remove();
                afficherNotification('üóëÔ∏è Photo supprim√©e', 'warning');
                mettreAJourStatistiques();
            }
        }

        // Sauvegarde temp√©ratures
        function sauvegarderTemperatures() {
            console.log('üíæ Sauvegarde temp√©ratures...');
            
            const donneeTemp = {
                id: 'temp_' + Date.now(),
                datetime: document.getElementById('temp-datetime').value,
                responsable: document.getElementById('temp-responsable').value,
                froide: parseFloat(document.getElementById('temp-froide').value) || null,
                negative: parseFloat(document.getElementById('temp-negative').value) || null,
                surgel1: parseFloat(document.getElementById('temp-surgel1').value) || null,
                ambiance: parseFloat(document.getElementById('temp-ambiance').value) || null,
                actions: document.getElementById('temp-actions').value,
                photos: document.getElementById('temp-photos').children.length
            };

            // V√©rifier conformit√©
            donneeTemp.conforme = verifierConformiteTemp(donneeTemp);
            
            // Ajouter aux donn√©es
            donnees.temperatures.unshift(donneeTemp);
            
            // Sauvegarder localement
            sauvegarderDonnees();
            
            // R√©initialiser le formulaire
            reinitialiserFormulaireTemp();
            
            // Recharger tableau
            chargerTableauTemperatures();
            
            // Mettre √† jour stats
            mettreAJourStatistiques();
            
            afficherNotification('‚úÖ Temp√©ratures sauvegard√©es avec succ√®s', 'success');
        }

        function verifierConformiteTemp(donnee) {
            const conformites = [];
            
            if (donnee.froide !== null) {
                conformites.push(Math.abs(donnee.froide - 4.2) <= 1);
            }
            if (donnee.negative !== null) {
                conformites.push(Math.abs(donnee.negative - (-13)) <= 2);
            }
            if (donnee.surgel1 !== null) {
                conformites.push(Math.abs(donnee.surgel1 - (-18)) <= 2);
            }
            if (donnee.ambiance !== null) {
                conformites.push(donnee.ambiance <= 25);
            }
            
            return conformites.length > 0 ? conformites.every(c => c === true) : true;
        }

        function reinitialiserFormulaireTemp() {
            const maintenant = new Date();
            document.getElementById('temp-datetime').value = maintenant.toISOString().slice(0, 16);
            document.getElementById('temp-froide').value = '';
            document.getElementById('temp-negative').value = '';
            document.getElementById('temp-surgel1').value = '';
            document.getElementById('temp-ambiance').value = '';
            document.getElementById('temp-actions').value = '';
            document.getElementById('temp-photos').innerHTML = '';
            
            // Retirer les classes d'alerte
            document.querySelectorAll('.temp-input').forEach(input => {
                input.classList.remove('alert');
            });
        }

        // Sauvegarde production
        function sauvegarderProduction() {
            console.log('üíæ Sauvegarde production...');
            
            const donneeProduction = {
                id: 'prod_' + Date.now(),
                lot: document.getElementById('prod-lot').value,
                variete: document.getElementById('prod-variete').value,
                quantite: parseInt(document.getElementById('prod-quantite').value) || 0,
                temperature: parseFloat(document.getElementById('prod-temperature').value) || null,
                photos: document.getElementById('prod-photos').children.length,
                datetime: new Date().toISOString()
            };

            if (!donneeProduction.variete || !donneeProduction.quantite) {
                afficherNotification('‚ö†Ô∏è Veuillez remplir les champs obligatoires', 'warning');
                return;
            }
            
            // Ajouter aux donn√©es
            donnees.productions.unshift(donneeProduction);
            
            // Sauvegarder localement
            sauvegarderDonnees();
            
            // R√©initialiser le formulaire
            reinitialiserFormulaireProduction();
            
            // Recharger tableau
            chargerTableauProductions();
            
            // Mettre √† jour stats
            mettreAJourStatistiques();
            
            afficherNotification('‚úÖ Production enregistr√©e avec succ√®s', 'success');
        }

        function genererNumeroLot() {
            const maintenant = new Date();
            const annee = maintenant.getFullYear().toString().slice(-2);
            const mois = (maintenant.getMonth() + 1).toString().padStart(2, '0');
            const jour = maintenant.getDate().toString().padStart(2, '0');
            const heure = maintenant.getHours().toString().padStart(2, '0');
            const minute = maintenant.getMinutes().toString().padStart(2, '0');
            
            const numeroLot = `MC${annee}${mois}${jour}-${heure}${minute}`;
            
            const lotField = document.getElementById('prod-lot');
            if (lotField) {
                lotField.value = numeroLot;
            }
        }

        function reinitialiserFormulaireProduction() {
            genererNumeroLot();
            document.getElementById('prod-variete').value = '';
            document.getElementById('prod-quantite').value = '';
            document.getElementById('prod-temperature').value = '';
            document.getElementById('prod-photos').innerHTML = '';
        }

        // Chargement tableaux
        function chargerTableauTemperatures() {
            const tbody = document.getElementById('table-temperatures');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (donnees.temperatures.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #666; padding: 30px;">Aucun contr√¥le enregistr√©</td></tr>';
                return;
            }
            
            donnees.temperatures.forEach(temp => {
                const row = tbody.insertRow();
                const dateFormat = new Date(temp.datetime).toLocaleString('fr-FR');
                const statut = temp.conforme ? 
                    '<span class="status-badge status-conforme">Conforme</span>' :
                    '<span class="status-badge status-non-conforme">Non-conforme</span>';
                
                row.innerHTML = `
                    <td>${dateFormat}</td>
                    <td>${temp.responsable}</td>
                    <td>${temp.froide !== null ? temp.froide + '¬∞C' : '-'}</td>
                    <td>${temp.negative !== null ? temp.negative + '¬∞C' : '-'}</td>
                    <td>${temp.surgel1 !== null ? temp.surgel1 + '¬∞C' : '-'}</td>
                    <td>${temp.ambiance !== null ? temp.ambiance + '¬∞C' : '-'}</td>
                    <td>${statut}</td>
                `;
            });
        }

        function chargerTableauProductions() {
            const tbody = document.getElementById('table-productions');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (donnees.productions.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #666; padding: 30px;">Aucune production enregistr√©e</td></tr>';
                return;
            }
            
            donnees.productions.forEach(prod => {
                const row = tbody.insertRow();
                
                row.innerHTML = `
                    <td>${prod.lot}</td>
                    <td>${prod.variete}</td>
                    <td>${prod.quantite} pcs</td>
                    <td>${prod.temperature ? prod.temperature + '¬∞C' : '-'}</td>
                    <td><span class="status-badge status-conforme">OK</span></td>
                `;
            });
        }

        function chargerHistorique() {
            const tbody = document.getElementById('table-historique');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            // Combiner tous les types de donn√©es
            const historique = [
                ...donnees.temperatures.map(t => ({...t, type: 'Temp√©rature'})),
                ...donnees.productions.map(p => ({...p, type: 'Production'}))
            ].sort((a, b) => new Date(b.datetime) - new Date(a.datetime));
            
            if (historique.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #666; padding: 30px;">Aucune donn√©e disponible</td></tr>';
                return;
            }
            
            historique.forEach(item => {
                const row = tbody.insertRow();
                const dateFormat = new Date(item.datetime).toLocaleString('fr-FR');
                const details = item.type === 'Temp√©rature' ? 
                    `${item.responsable} - Contr√¥le √©quipements` :
                    `${item.variete} - ${item.quantite} pcs`;
                const statut = item.conforme !== false ? 
                    '<span class="status-badge status-conforme">OK</span>' :
                    '<span class="status-badge status-non-conforme">Alerte</span>';
                
                row.innerHTML = `
                    <td>${dateFormat}</td>
                    <td>${item.type}</td>
                    <td>${item.responsable || 'N/A'}</td>
                    <td>${details}</td>
                    <td>${statut}</td>
                `;
            });
        }

        // Statistiques
        function mettreAJourStatistiques() {
            const conformes = donnees.temperatures.filter(t => t.conforme).length;
            const nonConformes = donnees.temperatures.filter(t => !t.conforme).length;
            const totalProductions = donnees.productions.length;
            const totalPhotos = donnees.temperatures.reduce((acc, t) => acc + (t.photos || 0), 0) +
                               donnees.productions.reduce((acc, p) => acc + (p.photos || 0), 0);

            document.getElementById('stat-conformes').textContent = conformes;
            document.getElementById('stat-non-conformes').textContent = nonConformes;
            document.getElementById('stat-productions').textContent = totalProductions;
            document.getElementById('stat-photos').textContent = totalPhotos;
        }

        // Sauvegarde locale
        function sauvegarderDonnees() {
            try {
                localStorage.setItem('pms_donnees', JSON.stringify(donnees));
                console.log('üíæ Donn√©es sauvegard√©es localement');
            } catch (e) {
                console.error('‚ùå Erreur sauvegarde:', e);
            }
        }

        function chargerDonnees() {
            try {
                const donneesStock = localStorage.getItem('pms_donnees');
                if (donneesStock) {
                    donnees = JSON.parse(donneesStock);
                    console.log('üìÅ Donn√©es charg√©es');
                }
            } catch (e) {
                console.error('‚ùå Erreur chargement:', e);
                donnees = {
                    temperatures: [],
                    productions: [],
                    actions: {}
                };
            }
        }

        // Exports
        function exporterTemperaturesPDF() {
            console.log('üìÑ Export PDF temp√©ratures...');
            
            if (!window.jsPDF) {
                afficherNotification('‚ùå Biblioth√®que PDF non disponible', 'danger');
                return;
            }
            
            const { jsPDF } = window.jsPDF;
            const doc = new jsPDF();
            
            // Titre
            doc.setFontSize(20);
            doc.text('Rapport Contr√¥le Temp√©ratures', 20, 30);
            
            // Info
            doc.setFontSize(12);
            doc.text(`G√©n√©r√© le: ${new Date().toLocaleString('fr-FR')}`, 20, 45);
            doc.text('MADAME COOKIES - Syst√®me PMS', 20, 55);
            
            // Donn√©es
            let y = 70;
            doc.setFontSize(14);
            doc.text('Derniers Contr√¥les:', 20, y);
            
            y += 15;
            doc.setFontSize(10);
            
            donnees.temperatures.slice(0, 10).forEach(temp => {
                const date = new Date(temp.datetime).toLocaleString('fr-FR');
                const statut = temp.conforme ? 'CONFORME' : 'NON-CONFORME';
                
                doc.text(`${date} - ${temp.responsable} - ${statut}`, 20, y);
                y += 8;
                
                if (y > 280) {
                    doc.addPage();
                    y = 20;
                }
            });
            
            // Sauvegarde
            const filename = `temperatures_${new Date().toISOString().slice(0, 10)}.pdf`;
            doc.save(filename);
            
            afficherNotification('üìÑ PDF g√©n√©r√© avec succ√®s', 'success');
        }

        function genererRapportPDF() {
            exporterTemperaturesPDF();
        }

        function exporterExcel() {
            console.log('üìä Export Excel...');
            
            let csvContent = "data:text/csv;charset=utf-8,";
            
            csvContent += "TEMPERATURES\n";
            csvContent += "Date,Responsable,Froide,Negative,Surgel1,Ambiance,Conforme\n";
            
            donnees.temperatures.forEach(temp => {
                const row = [
                    new Date(temp.datetime).toLocaleString('fr-FR'),
                    temp.responsable,
                    temp.froide || '',
                    temp.negative || '',
                    temp.surgel1 || '',
                    temp.ambiance || '',
                    temp.conforme ? 'OUI' : 'NON'
                ].join(',');
                csvContent += row + "\n";
            });
            
            csvContent += "\nPRODUCTIONS\n";
            csvContent += "Lot,Variete,Quantite,Temperature\n";
            
            donnees.productions.forEach(prod => {
                const row = [
                    prod.lot,
                    prod.variete,
                    prod.quantite,
                    prod.temperature || ''
                ].join(',');
                csvContent += row + "\n";
            });
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `donnees_pms_${new Date().toISOString().slice(0, 10)}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            afficherNotification('üìä Export CSV t√©l√©charg√©', 'success');
        }

        function sauvegarderLocal() {
            console.log('üíæ Sauvegarde locale...');
            
            const donneesBackup = {
                ...donnees,
                backup_date: new Date().toISOString(),
                version: '2.0'
            };
            
            const dataStr = JSON.stringify(donneesBackup, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `backup_pms_${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            afficherNotification('üíæ Sauvegarde t√©l√©charg√©e', 'success');
        }

        // Notifications
        function afficherNotification(message, type = 'info') {
            console.log(`üîî ${type.toUpperCase()}: ${message}`);
            
            const notification = document.createElement('div');
            notification.className = `alert alert-${type} notification`;
            
            const icon = type === 'success' ? '‚úÖ' : 
                         type === 'warning' ? '‚ö†Ô∏è' : 
                         type === 'danger' ? '‚ùå' : '‚ÑπÔ∏è';
            
            notification.innerHTML = `<span>${icon}</span> <div>${message}</div>`;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    notification.style.animation = 'slideInNotif 0.3s ease reverse';
                    setTimeout(() => {
                        if (document.body.contains(notification)) {
                            document.body.removeChild(notification);
                        }
                    }, 300);
                }
            }, 4000);
        }

        console.log('üç™ PMS Madame Cookies - JavaScript charg√© et pr√™t');
    </script>
</body>
</html>