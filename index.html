<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>PMS MADAME COOKIES v2.0</title>
    <link rel="stylesheet" href="styles.css">
  <script src="https://unpkg.com/tesseract.js@5.1.0/dist/tesseract.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.1/dist/jspdf.plugin.autotable.min.js"></script>
<script>
(function setDefaultHashForTabs(){
  try{ if(!location.hash){ location.replace(location.pathname + location.search + '#dashboard'); } }catch(e){}
})();
</script>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <div class="header">
            <div class="logo">
                <div class="logo-icon">üç™</div>
                <div>
                    <h1>MADAME COOKIES PMS</h1>
                    <div class="user-info">
                        <span id="current-user">Wendy JEAN MARIE</span> ‚Ä¢ 
                        <span id="current-date"></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="nav-tabs">
            <button class="nav-tab active" data-tab="dashboard">
                <span class="nav-icon">üìä</span>
                <span>Tableau</span>
            </button>
            <a class="nav-tab" href="#temperatures">
                <span class="nav-icon">üå°Ô∏è</span>
                <span>Temp√©ratures</span>
            </a>
            <a class="nav-tab" href="#production">
                <span class="nav-icon">üè≠</span>
                <span>Production</span>
            </a>
            <a class="nav-tab" href="#nettoyage">
                <span class="nav-icon">üßΩ</span>
                <span>Nettoyage</span>
            </a>
            <a class="nav-tab" href="#reception">
                <span class="nav-icon">üì¶</span>
                <span>R√©ception</span>
            </a>
            <a class="nav-tab" href="#historique">
                <span class="nav-icon">üìã</span>
                <span>Historique</span>
            </a>
            <a class="nav-tab" href="#exports">
                <span class="nav-icon">üìÑ</span>
                <span>Exports</span>
            </a>
        </div>

        <!-- Tableau de Bord -->
        <div class="tab-content active" id="dashboard">
            <div class="stats-grid">
                <div class="stat-card" style="border-left-color: #28a745;">
                    <div class="stat-number" style="color: #28a745;" id="stat-conformes">0</div>
                    <div class="stat-label">Contr√¥les OK</div>
                </div>
                <div class="stat-card" style="border-left-color: #dc3545;">
                    <div class="stat-number" style="color: #dc3545;" id="stat-non-conformes">0</div>
                    <div class="stat-label">Non-Conformit√©s</div>
                </div>
                <div class="stat-card" style="border-left-color: #ffc107;">
                    <div class="stat-number" style="color: #ffc107;" id="stat-productions">0</div>
                    <div class="stat-label">Lots Produits</div>
                </div>
                <div class="stat-card" style="border-left-color: #17a2b8;">
                    <div class="stat-number" style="color: #17a2b8;" id="stat-photos">0</div>
                    <div class="stat-label">Photos Prises</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üö® Statut du Jour</h2>
                </div>
                <div id="alertes-jour">
                    <div class="alert alert-success">
                        <span>‚úÖ</span> Syst√®me op√©rationnel - Pr√™t pour les contr√¥les
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üìÖ Actions Recommand√©es</h2>
                </div>
                <div class="checkbox-group" id="actions-jour">
                    <label class="checkbox-item">
                        <input type="checkbox" id="action-temp-matin" onchange="sauvegarderAction(this)">
                        <span><strong>08:00</strong> - Contr√¥le temp√©ratures √©quipements</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" id="action-production" onchange="sauvegarderAction(this)">
                        <span><strong>09:00</strong> - Saisie production du jour</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" id="action-temp-midi" onchange="sauvegarderAction(this)">
                        <span><strong>12:00</strong> - Second contr√¥le temp√©ratures</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" id="action-nettoyage" onchange="sauvegarderAction(this)">
                        <span><strong>13:00</strong> - Plan de nettoyage quotidien</span>
                    </label>
                </div>
            </div>
        </div>

        <!-- Contr√¥le Temp√©ratures -->
        <div class="tab-content" id="temperatures">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üå°Ô∏è Contr√¥le Temp√©ratures</h2>
                    <button class="btn btn-success" onclick="sauvegarderTemperatures()">
                        üíæ Sauvegarder
                    </button>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Date et Heure</label>
                        <input type="datetime-local" class="form-input" id="temp-datetime">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Responsable</label>
                        <select class="form-input" id="temp-responsable">
                            <option>Wendy JEAN MARIE</option>
                            <option>√âquipe Production</option>
                            <option>Nylaime MAMODALY BANDJEE</option>
                        </select>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">üßä Unit√© froide +2 portes<br><small>(Cible: 4,2¬∞C ¬± 1¬∞C)</small></label>
                        <input type="number" step="0.1" class="form-input temp-input" id="temp-froide" 
                               placeholder="Ex: 4.2" onchange="verifierTemperature(this, 4.2, 1)">
                    </div>
                    <div class="form-group">
                        <label class="form-label">‚ùÑÔ∏è Unit√© n√©gative<br><small>(Cible: -13¬∞C ¬± 2¬∞C)</small></label>
                        <input type="number" step="0.1" class="form-input temp-input" id="temp-negative" 
                               placeholder="Ex: -13.0" onchange="verifierTemperature(this, -13, 2)">
                    </div>
                    <div class="form-group">
                        <label class="form-label">üßä Surg√©lateur 1<br><small>(Cible: -18¬∞C ¬± 2¬∞C)</small></label>
                        <input type="number" step="0.1" class="form-input temp-input" id="temp-surgel1" 
                               placeholder="Ex: -18.0" onchange="verifierTemperature(this, -18, 2)">
                    </div>
                    <div class="form-group">
                        <label class="form-label">üßä Surg√©lateur 2<br><small>(Cible: -18¬∞C ¬± 2¬∞C)</small></label>
                        <input type="number" step="0.1" class="form-input temp-input" id="temp-surgel2" 
                               placeholder="Ex: -18.0" onchange="verifierTemperature(this, -18, 2)">
                    </div>
                    <div class="form-group">
                        <label class="form-label">üßä Surg√©lateur 3<br><small>(Cible: -18¬∞C ¬± 2¬∞C)</small></label>
                        <input type="number" step="0.1" class="form-input temp-input" id="temp-surgel3" 
                               placeholder="Ex: -18.0" onchange="verifierTemperature(this, -18, 2)">
                    </div>
                    <div class="form-group">
                        <label class="form-label">üå°Ô∏è Ambiance atelier<br><small>(Max: 25¬∞C)</small></label>
                        <input type="number" step="0.1" class="form-input temp-input" id="temp-ambiance" 
                               placeholder="Ex: 22.0" onchange="verifierTemperature(this, 25, 0, 'max')">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Actions correctives (si n√©cessaire)</label>
                    <textarea class="form-input" id="temp-actions" rows="3" 
                              placeholder="D√©crire les actions prises en cas de temp√©rature non conforme..."></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">üì∑ Photos √©quipements</label>
                    <div class="photo-upload" onclick="ouvrirCamera('temperatures')">
                        <span class="photo-icon">üì∑</span>
                        <div><strong>Prendre une photo</strong></div>
                        <div>√âquipements de froid</div>
                    </div>
                    <div class="photo-preview" id="temp-photos"></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üìä Derniers Contr√¥les</h2>
                    <button class="btn btn-primary" onclick="exporterTemperaturesPDF()">
                        üìÑ Export PDF
                    </button>
                </div>
                <div style="overflow-x: auto;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Date/Heure</th>
                                <th>Froide</th>
                                <th>N√©gative</th>
                                <th>Surg√©l.1</th>
                                <th>Surg√©l.2</th>
                                <th>Surg√©l.3</th>
                                <th>Ambiance</th>
                                <th>Statut</th>
                            </tr>
                        </thead>
                        <tbody id="table-temperatures">
                            <!-- Les donn√©es seront ajout√©es ici -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Production -->
        <div class="tab-content" id="production">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üè≠ Nouvelle Production</h2>
                    <button class="btn btn-success" onclick="sauvegarderProduction()">
                        üíæ Enregistrer
                    </button>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">N¬∞ Lot (auto-g√©n√©r√©)</label>
                        <input type="text" class="form-input" id="prod-lot" readonly>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Vari√©t√© Cookie</label>
                        <select class="form-input" id="prod-variete">
                            <option value="">-- Choisir une vari√©t√© --</option>
                            <option>LAIT</option>
                            <option>NOIR</option>
                            <option>3 CHOCOLAT</option>
                            <option>FULL</option>
                            <option>NATURE</option>
                            <option>KINDER</option>
                            <option>SNICKERS</option>
                            <option>MATCHA</option>
                            <option>M&MS</option>
                            <option>NOISETTES</option>
                            <option>P√âCAN</option>
                            <option>PISTACHE</option>
                            <option>SP√âCULOOS</option>
                            <option>CRANBERRIES</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Quantit√© (pi√®ces)</label>
                        <input type="number" class="form-input" id="prod-quantite" placeholder="Ex: 250">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Heure D√©but</label>
                        <input type="time" class="form-input" id="prod-debut">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Heure Fin</label>
                        <input type="time" class="form-input" id="prod-fin">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Temp√©rature Cuisson (¬∞C)</label>
                        <input type="number" class="form-input" id="prod-temperature" placeholder="160-180¬∞C">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Observations qualit√©</label>
                    <textarea class="form-input" id="prod-observations" rows="3" 
                              placeholder="Notes sur l'aspect, texture, cuisson..."></textarea>
                </div>

                
                    <div class="form-group">
                        <label class="form-label">üè∑Ô∏è √âtiquettes Mati√®res Premi√®res</label>
                        <div class="hint">Ajoute chaque MP, photographie l‚Äô√©tiquette : l‚ÄôOCR propose le <strong>N¬∞ de lot</strong>.</div>
                        <div id="mp-list" class="mp-list"></div>
                        <div class="mp-actions">
                            <button class="btn btn-secondary" type="button" id="btn-add-mp">‚ûï Ajouter une MP</button>
                        </div>
                    </div>
    <div class="form-group">
                    <label class="form-label">üì∑ Photos production</label>
                    <div class="photo-upload" onclick="ouvrirCamera('production')">
                        <span class="photo-icon">üì∑</span>
                        <div><strong>Photographier le lot</strong></div>
                        <div>Avant/pendant/apr√®s cuisson</div>
                    </div>
                    <div class="photo-preview" id="prod-photos"></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üìä Productions du Jour</h2>
                </div>
                <div style="overflow-x: auto;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>N¬∞ Lot</th>
                                <th>Vari√©t√©</th>
                                <th>Quantit√©</th>
                                <th>Heure</th>
                                <th>Temp√©rature</th>
                                <th>Statut</th>
                            </tr>
                        </thead>
                        <tbody id="table-productions">
                            <!-- Les donn√©es seront ajout√©es ici -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Autres sections... -->
        <div class="tab-content" id="nettoyage">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üßΩ Plan de Nettoyage</h2>
                    <button class="btn btn-success" onclick="sauvegarderNettoyage()">
                        üíæ Valider Plan
                    </button>
                </div>
                <p>Section Nettoyage - En d√©veloppement</p>
            </div>
        </div>

        <div class="tab-content" id="reception">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üì¶ R√©ception Marchandises</h2>
                    <button class="btn btn-success" onclick="sauvegarderReception()">
                        üíæ Enregistrer
                    </button>
                </div>
                <p>Section R√©ception - En d√©veloppement</p>
            </div>
        </div>

        <div class="tab-content" id="historique">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üìã Historique Complet</h2>
                </div>
                <div style="overflow-x: auto;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Date/Heure</th>
                                <th>Type</th>
                                <th>Responsable</th>
                                <th>D√©tails</th>
                                <th>Statut</th>
                            </tr>
                        </thead>
                        <tbody id="table-historique">
                            <!-- Les donn√©es seront ajout√©es ici -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="tab-content" id="exports">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üìÑ Exports et Rapports</h2>
                </div>
                <div class="form-grid">
  <button class="btn btn-success" onclick="genererRapportPDF()">üìÑ G√©n√©rer PDF</button>
  <button class="btn btn-primary" onclick="exporterExcel()">üìä Export CSV</button>
  <button class="btn btn-secondary" onclick="syncToGoogleSheets()">üîó Envoyer vers Google Sheets</button>
  <button class="btn btn-warning" onclick="syncToGitHub()">üêô Sauvegarder sur GitHub</button>
</div>
<div id="sync-settings" class="card" style="margin-top:16px;">
  <div class="card-header"><h3 class="card-title">‚öôÔ∏è Param√®tres de synchronisation</h3></div>
  <div class="form-grid">
    <div>
      <label class="form-label">Google Apps Script Web App URL</label>
      <input type="url" id="cfg-sheets-url" class="form-input" placeholder="https://script.google.com/macros/s/XXXX/exec">
    </div>
    <div>
      <label class="form-label">GitHub Owner / Repo</label>
      <div style="display:flex; gap:8px;">
        <input type="text" id="cfg-gh-owner" class="form-input" placeholder="madamecookies" style="flex:1;">
        <input type="text" id="cfg-gh-repo" class="form-input" placeholder="pms-data" style="flex:1;">
      </div>
    </div>
    <div>
      <label class="form-label">Branche / Dossier</label>
      <div style="display:flex; gap:8px;">
        <input type="text" id="cfg-gh-branch" class="form-input" placeholder="main" style="flex:1;">
        <input type="text" id="cfg-gh-folder" class="form-input" placeholder="exports" style="flex:1;">
      </div>
    </div>
    <div>
      <label class="form-label">GitHub Token (fine-grained)</label>
      <input type="password" id="cfg-gh-token" class="form-input" placeholder="ghp_...">
      <div class="hint">‚ö†Ô∏è Le token sera stock√© <strong>localement</strong> dans ce navigateur. Pr√©f√®re un token finement limit√© (repo cibl√© en lecture/√©criture de contenu uniquement).</div>
    </div>
  </div>
  <div class="form-grid" style="margin-top:8px;">
    <div>
      <label class="form-label">Export auto ‚Üí Google Sheets</label>
      <div style="display:flex;align-items:center;gap:8px;">
        <input type="checkbox" id="cfg-auto-sync"> <span>Activer</span>
        <input type="number" id="cfg-auto-every" class="form-input" value="5" min="1" style="width:80px"> <span>min</span>
      </div>
      <div class="hint">Simple et efficace : exporte r√©guli√®rement vers l‚ÄôURL Apps Script tant que la page est ouverte.</div>
    </div>
  </div>
  <div style="display:flex; gap:8px; justify-content:flex-end; padding:12px;">
    <button class="btn" onclick="chargerConfigSync()">Charger</button>
    <button class="btn btn-primary" onclick="sauverConfigSync()">Enregistrer</button>
  </div>
</div>
            </div>
        </div>
    </div>

    <!-- Modal Cam√©ra -->
    <div id="modalCamera" class="modal">
        <div class="modal-content">
            <span class="close" onclick="fermerCamera()">&times;</span>
            <h2 style="margin-bottom: 20px;">üì∑ Prendre une photo</h2>
            <video id="video" autoplay playsinline autoplay playsinline muted></video>
            <canvas id="canvas"></canvas>
            <div class="camera-controls">
                <button class="btn btn-success" onclick="prendrePhoto()">
                    üì∏ Capturer
                </button>
                <button class="btn btn-danger" onclick="fermerCamera()">
                    ‚ùå Annuler
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="app.js"></script>
</body>
</html>