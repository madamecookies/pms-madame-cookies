                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">‚úÖ Contr√¥les Obligatoires</label>
                    <div class="checkbox-group">
                        <label class="checkbox-item">
                            <input type="checkbox" id="ctrl-temp-mp">
                            <span>Temp√©rature mati√®res premi√®res v√©rifi√©e</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" id="ctrl-proprete">
                            <span>Propret√© √©quipements valid√©e</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" id="ctrl-hygiene">
                            <span>Hygi√®ne personnel respect√©e</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" id="ctrl-cuisson">
                            <span>Temp√©rature et dur√©e cuisson OK</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" id="ctrl-aspect">
                            <span>Aspect produits finis conforme</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" id="ctrl-refroid">
                            <span>Refroidissement rapide (&lt; 10¬∞C en 2h)</span>
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">üì∑ Photos Production</label>
                    <div class="photo-upload" onclick="ouvrirCamera('production')">
                        <span class="photo-icon">üì∑</span>
                        <div><strong>Photographier</strong></div>
                        <div>Cookies produits</div>
                    </div>
                    <div class="photo-preview" id="prod-photos"></div>
                </div>

                <div class="form-group">
                    <label class="form-label">Observations</label>
                    <textarea class="form-input" id="prod-observations" rows="3" 
                              placeholder="Anomalies, incidents, remarques particuli√®res..."></textarea>
                </div>
            </div>
        </div>

        <!-- Nettoyage -->
        <div class="tab-content" id="nettoyage">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üßΩ Plan de Nettoyage</h2>
                    <button class="btn btn-success" onclick="sauvegarderNettoyage()">
                        üíæ Enregistrer
                    </button>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Date</label>
                        <input type="date" class="form-input" id="nett-date">
                    </div>
                    <div class="form-group">
                        <label class="form-label">√âquipe</label>
                        <input type="text" class="form-input" id="nett-equipe" placeholder="Nom de l'√©quipe" value="√âquipe Production">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Type de Nettoyage</label>
                        <select class="form-input" id="nett-type">
                            <option>Nettoyage quotidien</option>
                            <option>Nettoyage hebdomadaire</option>
                            <option>Nettoyage approfondi</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">üßπ Zones √† Nettoyer</label>
                    <div class="checkbox-group">
                        <label class="checkbox-item">
                            <input type="checkbox" class="zone-check" data-zone="plans">
                            <span><strong>Plans de travail</strong> - D√©graissant + D√©sinfectant</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" class="zone-check" data-zone="petrins">
                            <span><strong>P√©trins (2√ó40L)</strong> - D√©graissant alimentaire</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" class="zone-check" data-zone="bouleuse">
                            <span><strong>Bouleuse</strong> - D√©graissant alimentaire</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" class="zone-check" data-zone="four">
                            <span><strong>Four (int√©rieur/ext√©rieur)</strong> - Nettoyant four</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" class="zone-check" data-zone="grilles">
                            <span><strong>Grilles et plaques</strong> - D√©graissant</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" class="zone-check" data-zone="frigos">
                            <span><strong>Chambres froides</strong> - D√©graissant + D√©sinfectant</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" class="zone-check" data-zone="sols">
                            <span><strong>Sols atelier</strong> - D√©graissant sols</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" class="zone-check" data-zone="dechets">
                            <span><strong>√âvacuation d√©chets</strong> - Sacs neufs</span>
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">üì∑ Photos Avant/Apr√®s</label>
                    <div class="photo-upload" onclick="ouvrirCamera('nettoyage')">
                        <span class="photo-icon">üì∑</span>
                        <div><strong>Photographier</strong></div>
                        <div>Zones nettoy√©es</div>
                    </div>
                    <div class="photo-preview" id="nett-photos"></div>
                </div>

                <div class="form-group">
                    <label class="form-label">Observations</label>
                    <textarea class="form-input" id="nett-observations" rows="3" 
                              placeholder="Difficult√©s rencontr√©es, produits manquants, zones n√©cessitant attention..."></textarea>
                </div>
            </div>
        </div>

        <!-- R√©ception -->
        <div class="tab-content" id="reception">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üì¶ Contr√¥le R√©ception</h2>
                    <button class="btn btn-success" onclick="sauvegarderReception()">
                        üíæ Valider
                    </button>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Date R√©ception</label>
                        <input type="date" class="form-input" id="recep-date">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Fournisseur</label>
                        <select class="form-input" id="recep-fournisseur">
                            <option>-- S√©lectionner --</option>
                            <option>FRAIS IMPORT</option>
                            <option>√âLEVAGE DU PATELIN</option>
                            <option>OVOCOOP</option>
                            <option>REUDIS</option>
                            <option>Autre</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">N¬∞ Bon de Livraison</label>
                        <input type="text" class="form-input" id="recep-bl" placeholder="Ex: BL001234">
                    </div>
                    <div class="form-group">
                        <label class="form-label">R√©ceptionnaire</label>
                        <input type="text" class="form-input" id="recep-nom" value="Wendy JEAN MARIE">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">‚úÖ Contr√¥les Transport</label>
                    <div class="checkbox-group">
                        <label class="checkbox-item">
                            <input type="checkbox" id="ctrl-vehicule">
                            <span>V√©hicule propre et hygi√©nique</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" id="ctrl-temperature-transport">
                            <span>Temp√©rature transport respect√©e</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" id="ctrl-chauffeur">
                            <span>Chauffeur en tenue correcte</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" id="ctrl-protection">
                            <span>Produits bien prot√©g√©s</span>
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">üì∑ Photos Livraison</label>
                    <div class="photo-upload" onclick="ouvrirCamera('reception')">
                        <span class="photo-icon">üì∑</span>
                        <div><strong>Photographier</strong></div>
                        <div>Produits re√ßus</div>
                    </div>
                    <div class="photo-preview" id="recep-photos"></div>
                </div>

                <div class="form-group">
                    <label class="form-label">D√©cision</label>
                    <select class="form-input" id="recep-decision">
                        <option value="accepte-total">‚úÖ Acceptation totale</option>
                        <option value="accepte-reserve">‚ö†Ô∏è Acceptation avec r√©serves</option>
                        <option value="refuse-partiel">üîÑ Refus partiel</option>
                        <option value="refuse-total">‚ùå Refus total</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Observations</label>
                    <textarea class="form-input" id="recep-observations" rows="3" 
                              placeholder="Anomalies d√©tect√©es, actions prises..."></textarea>
                </div>
            </div>
        </div>

        <!-- Historique -->
        <div class="tab-content" id="historique">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üìã Historique</h2>
                    <button class="btn btn-primary" onclick="filtrerHistorique()">
                        üîç Filtrer
                    </button>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Du</label>
                        <input type="date" class="form-input" id="filtre-debut">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Au</label>
                        <input type="date" class="form-input" id="filtre-fin">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Type</label>
                        <select class="form-input" id="filtre-type">
                            <option value="">Tous</option>
                            <option value="temperatures">Temp√©ratures</option>
                            <option value="production">Production</option>
                            <option value="nettoyage">Nettoyage</option>
                            <option value="reception">R√©ception</option>
                        </select>
                    </div>
                </div>

                <div style="overflow-x: auto;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Type</th>
                                <th>Responsable</th>
                                <th>Statut</th>
                                <th>Photos</th>
                            </tr>
                        </thead>
                        <tbody id="table-historique">
                            <!-- Donn√©es historiques -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Exports -->
        <div class="tab-content" id="exports">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üìÑ Exports DAAF</h2>
                </div>

                <div class="stats-grid">
                    <div class="stat-card" style="border-left-color: #28a745;">
                        <div class="stat-number" style="color: #28a745;">üìä</div>
                        <div class="stat-label">Temp√©ratures</div>
                        <button class="btn btn-success" onclick="exporterTemperaturesPDF()" style="margin-top: 10px; width: 100%;">
                            üìÑ Export PDF
                        </button>
                    </div>
                    <div class="stat-card" style="border-left-color: #007bff;">
                        <div class="stat-number" style="color: #007bff;">üè≠</div>
                        <div class="stat-label">Production</div>
                        <button class="btn btn-primary" onclick="exporterProductionPDF()" style="margin-top: 10px; width: 100%;">
                            üìÑ Export PDF
                        </button>
                    </div>
                    <div class="stat-card" style="border-left-color: #ffc107;">
                        <div class="stat-number" style="color: #ffc107;">üßΩ</div>
                        <div class="stat-label">Nettoyage</div>
                        <button class="btn btn-warning" onclick="exporterNettoyagePDF()" style="margin-top: 10px; width: 100%;">
                            üìÑ Export PDF
                        </button>
                    </div>
                    <div class="stat-card" style="border-left-color: #dc3545;">
                        <div class="stat-number" style="color: #dc3545;">üìã</div>
                        <div class="stat-label">Complet</div>
                        <button class="btn btn-danger" onclick="exporterCompletPDF()" style="margin-top: 10px; width: 100%;">
                            üìÑ Export PDF
                        </button>
                    </div>
                </div>

                <div class="alert alert-success">
                    <span>‚òÅÔ∏è</span> Sauvegarde automatique active - Donn√©es s√©curis√©es
                </div>

                <div class="form-group">
                    <label class="form-label">üóÑÔ∏è Export Donn√©es Excel</label>
                    <button class="btn btn-success" onclick="exporterExcel()" style="width: 100%;">
                        üìä T√©l√©charger toutes les donn√©es Excel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Cam√©ra -->
    <div id="modalCamera" class="modal">
        <div class="modal-content">
            <span class="close" onclick="fermerCamera()">&times;</span>
            <h2 style="text-align: center; margin-bottom: 20px;">üì∑ Prise de Photo</h2>
            <video id="video" autoplay></video>
            <canvas id="canvas"></canvas>
            <div class="camera-controls">
                <button class="btn btn-success" onclick="prendrePhoto()">
                    üì∏ Capturer
                </button>
                <button class="btn btn-danger" onclick="fermerCamera()">
                    ‚ùå Annuler
                </button>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let currentTab = 'dashboard';
        let stream = null;
        let currentPhotoType = '';
        let donneesPMS = {
            temperatures: [],
            productions: [],
            nettoyages: [],
            receptions: [],
            photos: []
        };

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            initialiserApp();
            chargerDonnees();
            configurerNavigation();
            definirDateActuelle();
            genererNumeroLot();
            mettreAJourStatistiques();
            chargerHistorique();
        });

        function initialiserApp() {
            // D√©sactiver le zoom sur les inputs (mobile)
            document.addEventListener('touchstart', {passive: true});
            
            // Emp√™cher le zoom sur double-tap
            let lastTouchEnd = 0;
            document.addEventListener('touchend', function (event) {
                const now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
        }

        function definirDateActuelle() {
            const maintenant = new Date();
            document.getElementById('current-date').textContent = maintenant.toLocaleDateString('fr-FR');
            
            // D√©finir datetime-local
            const datetimeLocal = maintenant.toISOString().slice(0, 16);
            document.getElementById('temp-datetime').value = datetimeLocal;
            
            // D√©finir dates
            const aujourd hui = maintenant.toISOString().split('T')[0];
            document.getElementById('nett-date').value = aujourdhui;
            document.getElementById('recep-date').value = aujourdhui;
            document.getElementById('filtre-debut').value = aujourdhui;
            document.getElementById('filtre-fin').value = aujourdhui;
            
            // D√©finir heure actuelle pour production
            const heureActuelle = maintenant.toTimeString().slice(0, 5);
            document.getElementById('prod-debut').value = heureActuelle;
        }

        function configurerNavigation() {
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    changerOnglet(tabId);
                });
            });
        }

        function changerOnglet(tabId) {
            // D√©sactiver tous les onglets
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Activer l'onglet s√©lectionn√©
            document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
            document.getElementById(tabId).classList.add('active');
            
            currentTab = tabId;
        }

        // Gestion des donn√©es
        function sauvegarderDonnees() {
            try {
                const dataString = JSON.stringify(donneesPMS);
                localStorage.setItem('pms_madame_cookies_v2', dataString);
                console.log('‚úÖ Donn√©es sauvegard√©es');
                return true;
            } catch (error) {
                console.error('‚ùå Erreur sauvegarde:', error);
                afficherAlerte('‚ùå Erreur de sauvegarde', 'danger');
                return false;
            }
        }

        function chargerDonnees() {
            try {
                const savedData = localStorage.getItem('pms_madame_cookies_v2');
                if (savedData) {
                    donneesPMS = JSON.parse(savedData);
                    console.log('‚úÖ Donn√©es charg√©es:', Object.keys(donneesPMS).map(k => `${k}: ${donneesPMS[k].length}`));
                }
            } catch (error) {
                console.error('‚ùå Erreur chargement:', error);
                donneesPMS = {
                    temperatures: [],
                    productions: [],
                    nettoyages: [],
                    receptions: [],
                    photos: []
                };
            }
        }

        // Gestion des temp√©ratures
        function verifierTemperature(input, cible, tolerance, type = 'range') {
            const valeur = parseFloat(input.value);
            if (isNaN(valeur)) return;
            
            let conforme = false;
            
            if (type === 'max') {
                conforme = valeur <= cible;
            } else {
                conforme = valeur >= (cible - tolerance) && valeur <= (cible + tolerance);
            }
            
            input.classList.remove('alert');
            
            if (!conforme) {
                input.classList.add('alert');
                
                // Vibration si support√©e
                if (navigator.vibrate) {
                    navigator.vibrate([200, 100, 200]);
                }
                
                const equipement = input.previousElementSibling.textContent.split('(')[0];
                afficherAlerte(`‚ö†Ô∏è ALERTE: ${equipement} = ${valeur}¬∞C - Hors limites !`, 'danger');
                
                // Actions correctives automatiques
                const suggestions = {
                    'temp-froide': 'V√©rifier joint porte, appeler maintenance froid',
                    'temp-negative': 'Contr√¥ler d√©givrage, v√©rifier compresseur', 
                    'temp-surgel': 'Transf√©rer produits urgence, maintenance imm√©diate',
                    'temp-ambiance': 'Am√©liorer ventilation, climatisation'
                };
                
                const suggestion = suggestions[input.id] || 'Maintenance n√©cessaire';
                document.getElementById('temp-actions').value = `ALERTE TEMP ${valeur}¬∞C: ${suggestion}`;
            }
            
            return conforme;
        }

        function sauvegarderTemperatures() {
            if (!validerFormulaireTemperatures()) return;
            
            const controle = {
                id: Date.now(),
                datetime: document.getElementById('temp-datetime').value,
                responsable: document.getElementById('temp-responsable').value,
                temperatures: {
                    froide: parseFloat(document.getElementById('temp-froide').value) || null,
                    negative: parseFloat(document.getElementById('temp-negative').value) || null,
                    surgel1: parseFloat(document.getElementById('temp-surgel1').value) || null,
                    surgel2: parseFloat(document.getElementById('temp-surgel2').value) || null,
                    surgel3: parseFloat(document.getElementById('temp-surgel3').value) || null,
                    ambiance: parseFloat(document.getElementById('temp-ambiance').value) || null
                },
                actions: document.getElementById('temp-actions').value,
                photos: obtenirPhotosParType('temperatures'),
                statut: calculerStatutTemperatures(),
                created_at: new Date().toISOString()
            };
            
            donneesPMS.temperatures.push(controle);
            
            if (sauvegarderDonnees()) {
                ajouterLigneHistoriqueTemp(controle);
                resetFormulaireTemperatures();
                afficherAlerte('‚úÖ Contr√¥le temp√©rature enregistr√© !', 'success');
                mettreAJourStatistiques();
                
                // Vibration succ√®s
                if (navigator.vibrate) {
                    navigator.vibrate(100);
                }
            }
        }

        function validerFormulaireTemperatures() {
            const inputs = ['temp-froide', 'temp-negative', 'temp-surgel1', 'temp-surgel2', 'temp-surgel3', 'temp-ambiance'];
            let auMoinsUneValeur = false;
            
            inputs.forEach(id => {
                const input = document.getElementById(id);
                if (input.value) {
                    auMoinsUneValeur = true;
                }
            });
            
            if (!auMoinsUneValeur) {
                afficherAlerte('‚ö†Ô∏è Veuillez saisir au moins une temp√©rature', 'warning');
                return false;
            }
            
            return true;
        }

        function calculerStatutTemperatures() {
            const inputs = ['temp-froide', 'temp-negative', 'temp-surgel1', 'temp-surgel2', 'temp-surgel3', 'temp-ambiance'];
            let conformes = 0;
            let total = 0;
            
            inputs.forEach(id => {
                const input = document.getElementById(id);
                if (input.value) {
                    total++;
                    if (!input.classList.contains('alert')) {
                        conformes++;
                    }
                }
            });
            
            if (conformes === total) return 'conforme';
            if (conformes > 0) return 'partiel';
            return 'non-conforme';
        }

        function resetFormulaireTemperatures() {
            ['temp-froide', 'temp-negative', 'temp-surgel1', 'temp-surgel2', 'temp-surgel3', 'temp-ambiance'].forEach(id => {
                const input = document.getElementById(id);
                input.value = '';
                input.classList.remove('alert');
            });
            document.getElementById('temp-actions').value = '';
            document.getElementById('temp-photos').innerHTML = '';
            
            // Nouvelle datetime
            document.getElementById('temp-datetime').value = new Date().toISOString().slice(0, 16);
        }

        function ajouterLigneHistoriqueTemp(controle) {
            const tbody = document.getElementById('table-temperatures');
            const row = tbody.insertRow(0);
            
            const date = new Date(controle.datetime).toLocaleString('fr-FR', {
                day: '2-digit',
                month: '2-digit', 
                hour: '2-digit',
                minute: '2-digit'
            });
            
            const statusClass = controle.statut === 'conforme' ? 'status-conforme' : 
                               controle.statut === 'partiel' ? 'status-non-conforme' : 'status-non-conforme';
            
            row.innerHTML = `
                <td>${date}</td>
                <td>${controle.temperatures.froide || '-'}¬∞C</td>
                <td>${controle.temperatures.negative || '-'}¬∞C</td>
                <td>${controle.temperatures.surgel1 || '-'}¬∞C</td>
                <td>${controle.temperatures.surgel2 || '-'}¬∞C</td>
                <td>${controle.temperatures.surgel3 || '-'}¬∞C</td>
                <td>${controle.temperatures.ambiance || '-'}¬∞C</td>
                <td><span class="status-badge ${statusClass}">${controle.statut}</span></td>
            `;
            
            // Limiter √† 10 lignes
            while (tbody.rows.length > 10) {
                tbody.deleteRow(tbody.rows.length - 1);
            }
        }

        // Gestion de la production
        function genererNumeroLot() {
            const today = new Date();
            const year = today.getFullYear().toString().substr(-2);
            const month = (today.getMonth() + 1).toString().padStart(2, '0');
            const day = today.getDate().toString().padStart(2, '0');
            
            // Compter les lots du jour
            const lotsAujourdhui = donneesPMS.productions.filter(p => {
                const prodDate = new Date(p.datetime || p.created_at);
                return prodDate.toDateString() === today.toDateString();
            }).length;
            
            const numeroLot = (lotsAujourdhui + 1).toString().padStart(2, '0');
            const lotId = `MC-${year}${month}${day}-${numeroLot}`;
            
            document.getElementById('prod-lot').value = lotId;
        }

        function sauvegarderProduction() {
            if (!validerFormulaireProduction()) return;
            
            const production = {
                id: Date.now(),
                datetime: new Date().toISOString(),
                lot: document.getElementById('prod-lot').value,
                variete: document.getElementById('prod-variete').value,
                quantite: parseInt(document.getElementById('prod-quantite').value),
                heureDebut: document.getElementById('prod-debut').value,
                heureFin: document.getElementById('prod-fin').value,
                temperature: parseFloat(document.getElementById('prod-temperature').value),
                controles: {
                    tempMP: document.getElementById('ctrl-temp-mp').checked,
                    proprete: document.getElementById('ctrl-proprete').checked,
                    hygiene: document.getElementById('ctrl-hygiene').checked,
                    cuisson: document.getElementById('ctrl-cuisson').checked,
                    aspect: document.getElementById('ctrl-aspect').checked,
                    refroid: document.getElementById('ctrl-refroid').checked
                },
                observations: document.getElementById('prod-observations').value,
                photos: obtenirPhotosParType('production'),
                responsable: document.getElementById('current-user').textContent,
                created_at: new Date().toISOString()
            };
            
            donneesPMS.productions.push(production);
            
            if (sauvegarderDonnees()) {
                resetFormulaireProduction();
                afficherAlerte('‚úÖ Production enregistr√©e !', 'success');
                mettreAJourStatistiques();
                genererNumeroLot();
                
                if (navigator.vibrate) {
                    navigator.vibrate(100);
                }
            }
        }

        function validerFormulaireProduction() {
            const variete = document.getElementById('prod-variete').value;
            const quantite = document.getElementById('prod-quantite').value;
            
            if (!variete) {
                afficherAlerte('‚ö†Ô∏è Veuillez s√©lectionner une vari√©t√© de cookie', 'warning');
                return false;
            }
            
            if (!quantite || quantite <= 0) {
                afficherAlerte('‚ö†Ô∏è Veuillez saisir une quantit√© valide', 'warning');
                return false;
            }
            
            return true;
        }

        function resetFormulaireProduction() {
            document.getElementById('prod-variete').selectedIndex = 0;
            document.getElementById('prod-quantite').value = '';
            document.getElementById('prod-temperature').value = '';
            document.getElementById('prod-observations').value = '';
            document.getElementById('prod-photos').innerHTML = '';
            
            // Reset checkboxes
            ['ctrl-temp-mp', 'ctrl-proprete', 'ctrl-hygiene', 'ctrl-cuisson', 'ctrl-aspect', 'ctrl-refroid'].forEach(id => {
                document.getElementById(id).checked = false;
            });
            
            // Nouvelle heure de d√©but
            document.getElementById('prod-debut').value = new Date().toTimeString().slice(0, 5);
            document.getElementById('prod-fin').value = '';
        }

        // Gestion du nettoyage
        function sauvegarderNettoyage() {
            if (!validerFormulaireNettoyage()) return;
            
            const zonesSelectionnees = [];
            document.querySelectorAll('.zone-check:checked').forEach(checkbox => {
                zonesSelectionnees.push({
                    zone: checkbox.dataset.zone,
                    nom: checkbox.parentElement.textContent.trim()
                });
            });
            
            const nettoyage = {
                id: Date.now(),
                date: document.getElementById('nett-date').value,
                equipe: document.getElementById('nett-equipe').value,
                type: document.getElementById('nett-type').value,
                zones: zonesSelectionnees,
                observations: document.getElementById('nett-observations').value,
                photos: obtenirPhotosParType('nettoyage'),
                created_at: new Date().toISOString()
            };
            
            donneesPMS.nettoyages.push(nettoyage);
            
            if (sauvegarderDonnees()) {
                resetFormulaireNettoyage();
                afficherAlerte('‚úÖ Plan de nettoyage enregistr√© !', 'success');
                mettreAJourStatistiques();
                
                if (navigator.vibrate) {
                    navigator.vibrate(100);
                }
            }
        }

        function validerFormulaireNettoyage() {
            const zonesChecked = document.querySelectorAll('.zone-check:checked').length;
            
            if (zonesChecked === 0) {
                afficherAlerte('‚ö†Ô∏è Veuillez s√©lectionner au moins une zone √† nettoyer', 'warning');
                return false;
            }
            
            return true;
        }

        function resetFormulaireNettoyage() {
            document.querySelectorAll('.zone-check').forEach(checkbox => {
                checkbox.checked = false;
            });
            document.getElementById('nett-observations').value = '';
            document.getElementById('nett-photos').innerHTML = '';
        }

        // Gestion de la r√©ception
        function sauvegarderReception() {
            if (!validerFormulaireReception()) return;
            
            const reception = {
                id: Date.now(),
                date: document.getElementById('recep-date').value,
                fournisseur: document.getElementById('recep-fournisseur').value,
                bonLivraison: document.getElementById('recep-bl').value,
                receptionnaire: document.getElementById('recep-nom').value,
                controles: {
                    vehicule: document.getElementById('ctrl-vehicule').checked,
                    temperature: document.getElementById('ctrl-temperature-transport').checked,
                    chauffeur: document.getElementById('ctrl-chauffeur').checked,
                    protection: document.getElementById('ctrl-protection').checked
                },
                decision: document.getElementById('recep-decision').value,
                observations: document.getElementById('recep-observations').value,
                photos: obtenirPhotosParType('reception'),
                created_at: new Date().toISOString()
            };
            
            donneesPMS.receptions.push(reception);
            
            if (sauvegarderDonnees()) {
                resetFormulaireReception();
                afficherAlerte('‚úÖ R√©ception enregistr√©e !', 'success');
                mettreAJourStatistiques();
                
                if (navigator.vibrate) {
                    navigator.vibrate(100);
                }
            }
        }

        function validerFormulaireReception() {
            const fournisseur = document.getElementById('recep-fournisseur').value;
            const bl = document.getElementById('recep-bl').value;
            
            if (!fournisseur || fournisseur === '-- S√©lectionner --') {
                afficherAlerte('‚ö†Ô∏è Veuillez s√©lectionner un fournisseur', 'warning');
                return false;
            }
            
            if (!bl) {
                afficherAlerte('‚ö†Ô∏è Veuillez saisir le num√©ro de bon de livraison', 'warning');
                return false;
            }
            
            return true;
        }

        function resetFormulaireReception() {
            document.getElementById('recep-fournisseur').selectedIndex = 0;
            document.getElementById('recep-bl').value = '';
            document.getElementById('recep-observations').value = '';
            document.getElementById('recep-photos').innerHTML = '';
            document.getElementById('recep-decision').selectedIndex = 0;
            
            ['ctrl-vehicule', 'ctrl-temperature-transport', 'ctrl-chauffeur', 'ctrl-protection'].forEach(id => {
                document.getElementById(id).checked = false;
            });
        }

        // Gestion de la cam√©ra
        function ouvrirCamera(type) {
            currentPhotoType = type;
            document.getElementById('modalCamera').style.display = 'block';
            
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: 'environment',  // Cam√©ra arri√®re en priorit√©
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    } 
                })
                .then(function(mediaStream) {
                    stream = mediaStream;
                    const video = document.getElementById('video');
                    video.srcObject = stream;
                    video.play();
                })
                .catch(function(err) {
                    console.error('Erreur cam√©ra:', err);
                    afficherAlerte('‚ùå Impossible d\'acc√©der √† la cam√©ra. V√©rifiez les permissions.', 'danger');
                    fermerCamera();
                });
            } else {
                afficherAlerte('‚ùå Cam√©ra non support√©e sur cet appareil', 'danger');
                fermerCamera();
            }
        }

        function fermerCamera() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
            document.getElementById('modalCamera').style.display = 'none';
        }

        function prendrePhoto() {
            const video = document.getElementById('video');
            const canvas = document.getElementById('canvas');
            const context = canvas.getContext('2d');
            
            // D√©finir taille optimale pour mobile
            canvas.width = Math.min(video.videoWidth, 800);
            canvas.height = Math.min(video.videoHeight, 600);
            
            // Dessiner l'image
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            // Convertir en base64 avec compression
            const dataURL = canvas.toDataURL('image/jpeg', 0.7);
            
            // Cr√©er objet photo
            const photo = {
                id: Date.now(),
                type: currentPhotoType,
                dataURL: dataURL,
                timestamp: new Date().toISOString(),
                size: Math.round(dataURL.length * 0.75) // Estimation taille
            };
            
            // Ajouter √† la collection
            donneesPMS.photos.push(photo);
            
            // Afficher l'aper√ßu
            ajouterPhotoApercu(photo);
            
            sauvegarderDonnees();
            fermerCamera();
            
            afficherAlerte('üì∑ Photo ajout√©e avec succ√®s !', 'success');
            
            // Vibration succ√®s
            if (navigator.vibrate) {
                navigator.vibrate(100);
            }
        }

        function ajouterPhotoApercu(photo) {
            const preview = document.getElementById(`${photo.type}-photos`);
            if (!preview) return;
            
            const photoDiv = document.createElement('div');
            photoDiv.className = 'photo-item';
            photoDiv.innerHTML = `
                <img src="${photo.dataURL}" alt="Photo ${photo.type}" loading="lazy">
                <button class="photo-delete" onclick="supprimerPhoto(${photo.id})" title="Supprimer">√ó</button>
            `;
            
            preview.appendChild(photoDiv);
        }

        function supprimerPhoto(photoId) {
            // Confirmer suppression
            if (!confirm('Supprimer cette photo ?')) return;
            
            // Supprimer de la collection
            donneesPMS.photos = donneesPMS.photos.filter(photo => photo.id !== photoId);
            
            // Supprimer de l'interface
            document.querySelectorAll('.photo-item').forEach(item => {
                const deleteBtn = item.querySelector('.photo-delete');
                if (deleteBtn && deleteBtn.onclick.toString().includes(photoId.toString())) {
                    item.remove();
                }
            });
            
            sauvegarderDonnees();
            afficherAlerte('üóëÔ∏è Photo supprim√©e', 'warning');
            mettreAJourStatistiques();
        }

        function obtenirPhotosParType(type) {
            return donneesPMS.photos.filter(photo => photo.type === type);
        }

        // Gestion des statistiques
        function mettreAJourStatistiques() {
            const conformes = donneesPMS.temperatures.filter(t => t.statut === 'conforme').length;
            const nonConformes = donneesPMS.temperatures.filter(t => t.statut === 'non-conforme').length;
            const productions = donneesPMS.productions.length;
            const photos = donneesPMS.photos.length;
            
            document.getElementById('stat-conformes').textContent = conformes;
            document.getElementById('stat-non-conformes').textContent = nonConformes;
            document.getElementById('stat-productions').textContent = productions;
            document.getElementById('stat-photos').textContent = photos;
            
            // Mettre √† jour les actions du jour
            mettreAJourActionsDuJour();
        }

        function mettreAJourActionsDuJour() {
            const aujourd hui = new Date().toDateString();
            
            // V√©rifier si temp√©rature du matin faite
            const tempMatin = donneesPMS.temperatures.some(t => {
                const date = new Date(t.datetime);
                return date.toDateString() === aujourdhui && date.getHours() < 10;
            });
            document.getElementById('action-temp-matin').checked = tempMatin;
            
            // V√©rifier si production saisie
            const prodAujourdhui = donneesPMS.productions.some(p => {
                const date = new Date(p.created_at);
                return date.toDateString() === aujourdhui;
            });
            document.getElementById('action-production').checked = prodAujourdhui;
            
            // V√©rifier temp√©rature midi
            const tempMidi = donneesPMS.temperatures.some(t => {
                const date = new Date(t.datetime);
                return date.toDateString() === aujourdhui && date.getHours() >= 12;
            });
            document.getElementById('action-temp-midi').checked = tempMidi;
            
            // V√©rifier nettoyage
            const nettoyageAujourdhui = donneesPMS.nettoyages.some(n => {
                const date = new Date(n.created_at);
                return date.toDateString() === aujourdhui;
            });
            document.getElementById('action-nettoyage').checked = nettoyageAujourdhui;
        }

        // Gestion des alertes
        function afficherAlerte(message, type) {
            const alerteDiv = document.createElement('div');
            alerteDiv.className = `alert alert-${type} floating-alert`;
            alerteDiv.innerHTML = message;
            
            document.body.appendChild(alerteDiv);
            
            // Supprimer apr√®s 4 secondes
            setTimeout(() => {
                if (document.body.contains(alerteDiv)) {
                    alerteDiv.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => {
                        if (document.body.contains(alerteDiv)) {
                            document.body.removeChild(alerteDiv);
                        }
                    }, 300);
                }
            }, 4000);
        }

        // Gestion de l'historique
        function chargerHistorique() {
            const tbody = document.getElementById('table-historique');
            tbody.innerHTML = '';
            
            // Combiner tous les contr√¥les
            const toutesLesEntrees = [
                ...donneesPMS.temperatures.map(t => ({...t, type: 'Temp√©ratures', icon: 'üå°Ô∏è'})),
                ...donneesPMS.productions.map(p => ({...p, type: 'Production', icon: 'üè≠'})),
                ...donneesPMS.nettoyages.map(n => ({...n, type: 'Nettoyage', icon: 'üßΩ'})),
                ...donneesPMS.receptions.map(r => ({...r, type: 'R√©ception', icon: 'üì¶'}))
            ];
            
            // Trier par date (plus r√©cent en premier)
            toutesLesEntrees.sort((a, b) => {
                const dateA = new Date(a.datetime || a.date || a.created_at);
                const dateB = new Date(b.datetime || b.date || b.created_at);
                return dateB - dateA;
            });
            
            // Afficher les 15 derniers
            toutesLesEntrees.slice(0, 15).forEach(item => {
                const row = tbody.insertRow();
                const date = new Date(item.datetime || item.date || item.created_at);
                const dateFormatee = date.toLocaleDateString('fr-FR', {
                    day: '2-digit',
                    month: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                const photos = obtenirPhotosParType(item.type.toLowerCase()).length;
                const statut = item.statut || item.decision || 'Termin√©';
                const statusClass = statut.includes('conforme') ? 'status-conforme' : 'status-conforme';
                
                row.innerHTML = `
                    <td>${dateFormatee}</td>
                    <td>${item.icon} ${item.type}</td>
                    <td>${item.responsable || item.equipe || item.receptionnaire || 'N/A'}</td>
                    <td><span class="status-badge ${statusClass}">${statut}</span></td>
                    <td>${photos > 0 ? `üì∑ ${photos}` : '-'}</td>
                `;
            });
        }

        function filtrerHistorique() {
            const debut = document.getElementById('filtre-debut').value;
            const fin = document.getElementById('filtre-fin').value;
            const type = document.getElementById('filtre-type').value;
            
            // Pour cette version simplifi√©e, on recharge tout
            // Dans une version serveur, on ferait une requ√™te filtr√©e
            chargerHistorique();
            
            afficherAlerte('üîç Historique mis √† jour', 'success');
        }

        // Fonctions d'export
        function exporterTemperaturesPDF() {
            const data = donneesPMS.temperatures;
            const contenu = genererContenuExport('Temp√©ratures', data);
            telechargerFichier(contenu, 'temperatures');
        }

        function exporterProductionPDF() {
            const data = donneesPMS.productions;
            const contenu = genererContenuExport('Production', data);
            telechargerFichier(contenu, 'production');
        }

        function exporterNettoyagePDF() {
            const data = donneesPMS.nettoyages;
            const contenu = genererContenuExport('Nettoyage', data);
            telechargerFichier(contenu, 'nettoyage');
        }

        function exporterCompletPDF() {
            const data = {
                entreprise: {
                    nom: 'MADAME COOKIES',
                    siret: '94389212500015',
                    adresse: '36 RUE RAYMOND MONDON 97419 LA POSSESSION',
                    responsable: 'Nylaime MAMODALY BANDJEE'
                },
                periode: {
                    debut: new Date(Date.now() - 30*24*60*60*1000).toISOString().split('T')[0],
                    fin: new Date().toISOString().split('T')[0]
                },
                donnees: donneesPMS,
                statistiques: {
                    totalControles: donneesPMS.temperatures.length,
                    conformes: donneesPMS.temperatures.filter(t => t.statut === 'conforme').length,
                    productions: donneesPMS.productions.length,
                    nettoyages: donneesPMS.nettoyages.length,
                    photos: donneesPMS.photos.length
                },
                genere_le: new Date().toISOString()
            };
            
            const contenu = JSON.stringify(data, null, 2);
            telechargerFichier(contenu, 'PMS-COMPLET-DAAF', 'json');
        }

        function exporterExcel() {
            // G√©n√©rer CSV simple pour Excel
            let csvContent = "Type,Date,Responsable,Statut,Details\n";
            
            // Temp√©ratures
            donneesPMS.temperatures.forEach(t => {
                csvContent += `Temp√©rature,"${t.datetime}","${t.responsable}","${t.statut}","Froide: ${t.temperatures.froide}¬∞C N√©gative: ${t.temperatures.negative}¬∞C"\n`;
            });
            
            // Productions
            donneesPMS.productions.forEach(p => {
                csvContent += `Production,"${p.created_at}","${p.responsable}","Termin√©","Lot: ${p.lot} Vari√©t√©: ${p.variete} Quantit√©: ${p.quantite}"\n`;
            });
            
            // Nettoyages
            donneesPMS.nettoyages.forEach(n => {
                csvContent += `Nettoyage,"${n.created_at}","${n.equipe}","Termin√©","Type: ${n.type} Zones: ${n.zones.length}"\n`;
            });
            
            telechargerFichier(csvContent, 'donnees-excel', 'csv');
        }

        function genererContenuExport(type, data) {
            return `RAPPORT ${type.toUpperCase()} - MADAME COOKIES
===========================================

Entreprise: MADAME COOKIES
SIRET: 94389212500015
Adresse: 36 RUE RAYMOND MONDON 97419 LA POSSESSION

P√©riode: ${new Date().toLocaleDateString('fr-FR')}
Nombre d'enregistrements: ${data.length}

DONN√âES:
${JSON.stringify(data, null, 2)}

Rapport g√©n√©r√© automatiquement le ${new Date().toLocaleString('fr-FR')}
Syst√®me PMS v2.0 - Application certifi√©e DAAF`;
        }

        function telechargerFichier(contenu, nom, extension = 'txt') {
            const blob = new Blob([contenu], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${nom}-${new Date().toISOString().split('T')[0]}.${extension}`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            afficherAlerte(`üìÑ Export ${nom} t√©l√©charg√© !`, 'success');
        }

        // Auto-save toutes les 2 minutes
        setInterval(() => {
            if (donneesPMS && Object.values(donneesPMS).some(arr => arr.length > 0)) {
                sauvegarderDonnees();
            }
        }, 2 * 60 * 1000);

        // Gestion des √©v√©nements tactiles
        document.addEventListener('touchstart', function(e) {
            // Am√©liorer la r√©activit√© tactile
        }, { passive: true });

        // Pr√©venir la fermeture accidentelle
        window.addEventListener('beforeunload', function(e) {
            if (Object.values(donneesPMS).some(arr => arr.length > 0)) {
                e.preventDefault();
                e.returnValue = '';
                return 'Des donn√©es non sauvegard√©es pourraient √™tre perdues.';
            }
        });

        // Style pour l'animation de sortie
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideOut {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);

    </script>
</body>
</html><!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>PMS MADAME COOKIES v2.0</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }

        .app-container {
            max-width: 100%;
            margin: 0 auto;
            padding: 10px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 15px 20px;
            border-radius: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            text-align: center;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 10px;
        }

        .logo-icon {
            font-size: 32px;
            animation: rotate 4s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .logo h1 {
            color: #2c3e50;
            font-size: 22px;
            font-weight: 800;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .user-info {
            color: #7f8c8d;
            font-size: 14px;
        }

        .nav-tabs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 8px;
            margin-bottom: 20px;
        }

        .nav-tab {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 15px;
            padding: 12px 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 700;
            color: #7f8c8d;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            min-height: 70px;
            backdrop-filter: blur(10px);
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .nav-icon {
            font-size: 20px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .card-title {
            font-size: 20px;
            font-weight: 800;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 12px 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 700;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            min-height: 44px;
        }

        .btn:hover, .btn:active {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #55efc4, #00b894);
        }

        .btn-warning {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff7675, #d63031);
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        @media (min-width: 768px) {
            .form-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            }
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-label {
            font-weight: 700;
            margin-bottom: 8px;
            color: #2c3e50;
            font-size: 14px;
        }

        .form-input, .form-select {
            padding: 12px 15px;
            border: 2px solid #e1e8ed;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
            min-height: 44px;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .temp-input.alert {
            background: #fee;
            border-color: #dc3545;
            animation: shake 0.5s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        @media (min-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-left: 4px solid;
        }

        .stat-number {
            font-size: 28px;
            font-weight: 900;
            margin-bottom: 8px;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 12px;
            text-transform: uppercase;
            font-weight: 700;
        }

        .photo-upload {
            border: 3px dashed #e1e8ed;
            border-radius: 15px;
            padding: 30px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
            margin: 15px 0;
        }

        .photo-upload:hover, .photo-upload.active {
            border-color: #667eea;
            background: #f0f8ff;
            transform: translateY(-2px);
        }

        .photo-icon {
            font-size: 48px;
            margin-bottom: 10px;
            display: block;
        }

        .photo-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }

        .photo-item {
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .photo-item img {
            width: 100%;
            height: 100px;
            object-fit: cover;
        }

        .photo-delete {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .alert {
            padding: 15px 20px;
            margin: 15px 0;
            border-radius: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border-left: 4px solid #ffc107;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .data-table th,
        .data-table td {
            padding: 12px 8px;
            text-align: left;
            border-bottom: 1px solid #e1e8ed;
            font-size: 13px;
        }

        .data-table th {
            background: #f8f9fa;
            font-weight: 700;
            color: #2c3e50;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .status-conforme {
            background: #d4edda;
            color: #155724;
        }

        .status-non-conforme {
            background: #f8d7da;
            color: #721c24;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 20px;
            width: 95%;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            position: relative;
        }

        .close {
            position: absolute;
            right: 20px;
            top: 20px;
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: #f8f9fa;
        }

        .close:hover {
            color: #000;
            background: #e9ecef;
        }

        #video {
            width: 100%;
            max-width: 300px;
            border-radius: 12px;
            margin: 20px auto;
            display: block;
        }

        #canvas {
            display: none;
        }

        .camera-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .floating-alert {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 2000;
            max-width: 350px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin: 15px 0;
        }

        @media (min-width: 768px) {
            .checkbox-group {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .checkbox-item:hover {
            background: #e9ecef;
        }

        .checkbox-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive am√©lior√© */
        @media (max-width: 768px) {
            .app-container {
                padding: 5px;
            }
            
            .header {
                padding: 10px 15px;
                margin-bottom: 15px;
            }
            
            .logo h1 {
                font-size: 18px;
            }
            
            .card {
                padding: 15px;
                margin-bottom: 15px;
            }
            
            .card-title {
                font-size: 18px;
            }
            
            .btn {
                padding: 10px 15px;
                font-size: 13px;
            }
            
            .data-table {
                font-size: 11px;
            }
            
            .data-table th,
            .data-table td {
                padding: 8px 4px;
            }
        }

        /* Am√©lioration accessibilit√© mobile */
        @media (max-width: 480px) {
            .nav-tabs {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .form-input, .form-select {
                font-size: 16px; /* Emp√™che le zoom sur iOS */
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <div class="header">
            <div class="logo">
                <div class="logo-icon">üç™</div>
                <div>
                    <h1>MADAME COOKIES PMS</h1>
                    <div class="user-info">
                        <span id="current-user">Wendy JEAN MARIE</span> ‚Ä¢ 
                        <span id="current-date"></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="nav-tabs">
            <button class="nav-tab active" data-tab="dashboard">
                <span class="nav-icon">üìä</span>
                <span>Tableau</span>
            </button>
            <button class="nav-tab" data-tab="temperatures">
                <span class="nav-icon">üå°Ô∏è</span>
                <span>Temp√©ratures</span>
            </button>
            <button class="nav-tab" data-tab="production">
                <span class="nav-icon">üè≠</span>
                <span>Production</span>
            </button>
            <button class="nav-tab" data-tab="nettoyage">
                <span class="nav-icon">üßΩ</span>
                <span>Nettoyage</span>
            </button>
            <button class="nav-tab" data-tab="reception">
                <span class="nav-icon">üì¶</span>
                <span>R√©ception</span>
            </button>
            <button class="nav-tab" data-tab="historique">
                <span class="nav-icon">üìã</span>
                <span>Historique</span>
            </button>
            <button class="nav-tab" data-tab="exports">
                <span class="nav-icon">üìÑ</span>
                <span>Exports</span>
            </button>
        </div>

        <!-- Tableau de Bord -->
        <div class="tab-content active" id="dashboard">
            <div class="stats-grid">
                <div class="stat-card" style="border-left-color: #28a745;">
                    <div class="stat-number" style="color: #28a745;" id="stat-conformes">0</div>
                    <div class="stat-label">Contr√¥les OK</div>
                </div>
                <div class="stat-card" style="border-left-color: #dc3545;">
                    <div class="stat-number" style="color: #dc3545;" id="stat-non-conformes">0</div>
                    <div class="stat-label">Non-Conformit√©s</div>
                </div>
                <div class="stat-card" style="border-left-color: #ffc107;">
                    <div class="stat-number" style="color: #ffc107;" id="stat-productions">0</div>
                    <div class="stat-label">Lots Produits</div>
                </div>
                <div class="stat-card" style="border-left-color: #17a2b8;">
                    <div class="stat-number" style="color: #17a2b8;" id="stat-photos">0</div>
                    <div class="stat-label">Photos Prises</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üö® Statut du Jour</h2>
                </div>
                <div id="alertes-jour">
                    <div class="alert alert-success">
                        <span>‚úÖ</span> Syst√®me op√©rationnel - Pr√™t pour les contr√¥les
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üìÖ Actions Recommand√©es</h2>
                </div>
                <div class="checkbox-group" id="actions-jour">
                    <label class="checkbox-item">
                        <input type="checkbox" id="action-temp-matin">
                        <span><strong>08:00</strong> - Contr√¥le temp√©ratures √©quipements</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" id="action-production">
                        <span><strong>09:00</strong> - Saisie production du jour</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" id="action-temp-midi">
                        <span><strong>12:00</strong> - Second contr√¥le temp√©ratures</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" id="action-nettoyage">
                        <span><strong>13:00</strong> - Plan de nettoyage quotidien</span>
                    </label>
                </div>
            </div>
        </div>

        <!-- Contr√¥le Temp√©ratures -->
        <div class="tab-content" id="temperatures">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üå°Ô∏è Contr√¥le Temp√©ratures</h2>
                    <button class="btn btn-success" onclick="sauvegarderTemperatures()">
                        üíæ Sauvegarder
                    </button>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Date et Heure</label>
                        <input type="datetime-local" class="form-input" id="temp-datetime">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Responsable</label>
                        <select class="form-input" id="temp-responsable">
                            <option>Wendy JEAN MARIE</option>
                            <option>√âquipe Production</option>
                            <option>Nylaime MAMODALY BANDJEE</option>
                        </select>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">üßä Unit√© froide +2 portes<br><small>(Cible: 4,2¬∞C ¬± 1¬∞C)</small></label>
                        <input type="number" step="0.1" class="form-input temp-input" id="temp-froide" 
                               placeholder="Ex: 4.2" onchange="verifierTemperature(this, 4.2, 1)">
                    </div>
                    <div class="form-group">
                        <label class="form-label">‚ùÑÔ∏è Unit√© n√©gative<br><small>(Cible: -13¬∞C ¬± 2¬∞C)</small></label>
                        <input type="number" step="0.1" class="form-input temp-input" id="temp-negative" 
                               placeholder="Ex: -13.0" onchange="verifierTemperature(this, -13, 2)">
                    </div>
                    <div class="form-group">
                        <label class="form-label">üßä Surg√©lateur 1<br><small>(Cible: -18¬∞C ¬± 2¬∞C)</small></label>
                        <input type="number" step="0.1" class="form-input temp-input" id="temp-surgel1" 
                               placeholder="Ex: -18.0" onchange="verifierTemperature(this, -18, 2)">
                    </div>
                    <div class="form-group">
                        <label class="form-label">üßä Surg√©lateur 2<br><small>(Cible: -18¬∞C ¬± 2¬∞C)</small></label>
                        <input type="number" step="0.1" class="form-input temp-input" id="temp-surgel2" 
                               placeholder="Ex: -18.0" onchange="verifierTemperature(this, -18, 2)">
                    </div>
                    <div class="form-group">
                        <label class="form-label">üßä Surg√©lateur 3<br><small>(Cible: -18¬∞C ¬± 2¬∞C)</small></label>
                        <input type="number" step="0.1" class="form-input temp-input" id="temp-surgel3" 
                               placeholder="Ex: -18.0" onchange="verifierTemperature(this, -18, 2)">
                    </div>
                    <div class="form-group">
                        <label class="form-label">üå°Ô∏è Ambiance atelier<br><small>(Max: 25¬∞C)</small></label>
                        <input type="number" step="0.1" class="form-input temp-input" id="temp-ambiance" 
                               placeholder="Ex: 22.0" onchange="verifierTemperature(this, 25, 0, 'max')">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Actions correctives (si n√©cessaire)</label>
                    <textarea class="form-input" id="temp-actions" rows="3" 
                              placeholder="D√©crire les actions prises en cas de temp√©rature non conforme..."></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">üì∑ Photos √©quipements</label>
                    <div class="photo-upload" onclick="ouvrirCamera('temperatures')">
                        <span class="photo-icon">üì∑</span>
                        <div><strong>Prendre une photo</strong></div>
                        <div>√âquipements de froid</div>
                    </div>
                    <div class="photo-preview" id="temp-photos"></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üìä Derniers Contr√¥les</h2>
                    <button class="btn btn-primary" onclick="exporterTemperaturesPDF()">
                        üìÑ Export PDF
                    </button>
                </div>
                <div style="overflow-x: auto;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Date/Heure</th>
                                <th>Froide</th>
                                <th>N√©gative</th>
                                <th>Surg√©.1</th>
                                <th>Surg√©.2</th>
                                <th>Surg√©.3</th>
                                <th>Ambiance</th>
                                <th>Statut</th>
                            </tr>
                        </thead>
                        <tbody id="table-temperatures">
                            <!-- Les donn√©es seront ajout√©es ici -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Production -->
        <div class="tab-content" id="production">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üè≠ Nouvelle Production</h2>
                    <button class="btn btn-success" onclick="sauvegarderProduction()">
                        üíæ Enregistrer
                    </button>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">N¬∞ Lot (auto-g√©n√©r√©)</label>
                        <input type="text" class="form-input" id="prod-lot" readonly>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Vari√©t√© Cookie</label>
                        <select class="form-input" id="prod-variete">
                            <option value="">-- Choisir une vari√©t√© --</option>
                            <option>LAIT</option>
                            <option>NOIR</option>
                            <option>3 CHOCOLAT</option>
                            <option>FULL</option>
                            <option>NATURE</option>
                            <option>KINDER</option>
                            <option>SNICKERS</option>
                            <option>MATCHA</option>
                            <option>M&MS</option>
                            <option>NOISETTES</option>
                            <option>P√âCAN</option>
                            <option>PISTACHE</option>
                            <option>SP√âCULOOS</option>
                            <option>CRANBERRIES</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Quantit√© (pi√®ces)</label>
                        <input type="number" class="form-input" id="prod-quantite" placeholder="Ex: 250">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Heure D√©but</label>
                        <input type="time" class="form-input" id="prod-debut">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Heure Fin</label>
                        <input type="time" class="form-input" id="prod-fin">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Temp√©rature Cuisson (¬∞C)</label>
                        <input type="number" class="form-input" id="prod-temperature" placeholder="160-180¬∞C">
                    